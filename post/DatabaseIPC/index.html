<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head>
    <meta charset="utf-8">
    <meta name="google-site-verification" content="Is5NCRh3gMI3ic8PKbNsXzLtoQu1b2ywfIoPhkv3JYA" />
    <!--
        © Material Theme
        https://github.com/bollnh/hexo-theme-material
        Version: 1.5.6 -->
    <script>
        window.materialVersion = "1.5.6"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1',
            '1.5.0',
            '1.5.2',
            '1.5.5'
        ]
    </script>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">



    <link rel="dns-prefetch" href="https://busuanzi.ibruce.info"/>



    <link rel="dns-prefetch" href="https://www-xjunz-top.disqus.com"/>





    <link rel="dns-prefetch" href="https://fonts.googleapis.com"/>





    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!-- Title -->
    
    <title>
        
            How to Implement Inter-Process Database Communication Rid of ContentProvider? | 
        
        Me, xjunz&#39;s blog
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.svg">
    <link rel="icon" href="/img/favicon.svg">

    <meta name="format-detection" content="telephone=no"/>
    <meta name="description" itemprop="description" content="xjunz&#39;s blog">
    <meta name="keywords" content="">
    <meta name="theme-color" content="#ffc3ac">

    <!-- Disable Fucking Bloody Baidu Tranformation -->
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(a){try{localStorage.removeItem(a)}catch(b){}};lsloader.setLS=function(a,c){try{localStorage.setItem(a,c)}catch(b){}};lsloader.getLS=function(a){var c="";try{c=localStorage.getItem(a)}catch(b){c=""}return c};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var b=[];for(var a=0;a<localStorage.length;a++){b.push(localStorage.key(a))}b.forEach(function(e){var f=lsloader.getLS(e);if(window.oldVersion){var d=window.oldVersion.reduce(function(g,h){return g||f.indexOf("/*"+h+"*/")!==-1},false);if(d){lsloader.removeLS(e)}}})}catch(c){}};lsloader.clean();lsloader.load=function(f,a,b,d){if(typeof b==="boolean"){d=b;b=undefined}d=d||false;b=b||function(){};var e;e=this.getLS(f);if(e&&e.indexOf(versionString)===-1){this.removeLS(f);this.requestResource(f,a,b,d);return}if(e){var c=e.split(versionString)[0];if(c!=a){console.log("reload:"+a);this.removeLS(f);this.requestResource(f,a,b,d);return}e=e.split(versionString)[1];if(d){this.jsRunSequence.push({name:f,code:e});this.runjs(a,f,e)}else{document.getElementById(f).appendChild(document.createTextNode(e));b()}}else{this.requestResource(f,a,b,d)}};lsloader.requestResource=function(b,e,a,c){var d=this;if(c){this.iojs(e,b,function(h,f,g){d.setLS(f,h+versionString+g);d.runjs(h,f,g)})}else{this.iocss(e,b,function(f){document.getElementById(b).appendChild(document.createTextNode(f));d.setLS(b,e+versionString+f)},a)}};lsloader.iojs=function(d,b,g){var a=this;a.jsRunSequence.push({name:b,code:""});try{var f=new XMLHttpRequest();f.open("get",d,true);f.onreadystatechange=function(){if(f.readyState==4){if((f.status>=200&&f.status<300)||f.status==304){if(f.response!=""){g(d,b,f.response);return}}a.jsfallback(d,b)}};f.send(null)}catch(c){a.jsfallback(d,b)}};lsloader.iocss=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.iofonts=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.runjs=function(f,c,e){if(!!c&&!!e){for(var b in this.jsRunSequence){if(this.jsRunSequence[b].name==c){this.jsRunSequence[b].code=e}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var a=document.createElement("script");a.appendChild(document.createTextNode(this.jsRunSequence[0].code));a.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(a);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else{if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var d=this;var a=document.createElement("script");a.src=this.jsRunSequence[0].path;a.type="text/javascript";this.jsRunSequence[0].status="loading";a.onload=function(){d.jsRunSequence.shift();if(d.jsRunSequence.length>0){d.runjs()}};document.body.appendChild(a)}}};lsloader.tagLoad=function(b,a){this.jsRunSequence.push({name:a,code:"",path:b,status:"failed"});this.runjs()};lsloader.jsfallback=function(c,b){if(!!this.jsnamemap[b]){return}else{this.jsnamemap[b]=b}for(var a in this.jsRunSequence){if(this.jsRunSequence[a].name==b){this.jsRunSequence[a].code="";this.jsRunSequence[a].status="failed";this.jsRunSequence[a].path=c}}this.runjs()};lsloader.cssfallback=function(e,c,b){if(!!this.cssnamemap[c]){return}else{this.cssnamemap[c]=1}var d=document.createElement("link");d.type="text/css";d.href=e;d.rel="stylesheet";d.onload=d.onerror=b;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(d,a)};lsloader.runInlineScript=function(c,b){var a=document.getElementById(b).innerText;this.jsRunSequence.push({name:c,code:a});this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Import CSS -->
    <style id="xjunz-mod_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("xjunz-mod_css","/css/xjunz-mod.css?BCzsgmao0pFHblXjcivpwA==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","/css/material.min.css?Z7a72R1E4SxzBKR/WGctOA==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","/css/style.min.css?uVzgA6RLrOm13Ukw8Qgy+A==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        
            
                <style id="prettify_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_css","/css/prettify.min.css?zp8STOU9v89XWFEnN+6YmQ==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
                <style id="prettify_theme"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_theme","/css/prettify/github-v2.min.css?AfzKxt++K+/lhZBlSjnxwg==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
            
        

    

    

    <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Noto Serif SC, Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "微软雅黑", "Microsoft YaHei", Arial, sans-serif;
    overflow-x: hidden !important;
  }
  
  code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    letter-spacing: .0em !important;
  }

  a {
    color: #ff4e58;
    letter-spacing: .1em;
  }

  p.article-headline-p{
   font-family: Roboto !important;
  }

  p {
    letter-spacing: .15em;
    font-family: Noto Serif SC !important;
  }

  div {
    letter-spacing: .15em;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #ff4e58 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #ff4e58 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #ff4e58 !important;
  }

  .toTop {
    background: #ff4e58 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #ff4e58;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #ff4e58;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #ff4e58;
  }

  .post-toc a:hover {
    color: #ff4e58;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body {
        background-color: #faf2f1;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text {
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->
<!-- Import Roboto -->

    <!-- "https://fonts.googleapis.com/css?family=Roboto:300,400,500" -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC&display=swap" rel="stylesheet">




<!-- Import Material Icons -->


    <style id="material_icons"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_icons","/css/material-icons.css?pqhB/Rd/ab0H2+kZp0RDmw==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>




    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","/js/jquery.min.js?ezyEvm8ST5CGfpA+kFFi1g==", true)</script>
    

    <!-- WebAPP Icons -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Me, xjunz&#39;s blog">
    <meta name="msapplication-starturl" content="http://www.xjunz.top/post/DatabaseIPC/">
    <meta name="msapplication-navbutton-color" content="#ffc3ac">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Me, xjunz&#39;s blog">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="/img/favicon.svg">

    <!-- Site Verification -->
    
    

    <!-- RSS -->
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://www.xjunz.top/post/DatabaseIPC/">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="How to Implement Inter-Process Database Communication Rid of ContentProvider? | Me, xjunz&#39;s blog">
    <meta property="og:image" content="/img/favicon.svg">
    <meta property="og:description" content="xjunz&#39;s blog">
    

    
        <meta property="article:published_time" content="Sat Jul 16 2022 15:03:59 GMT+0800">
        <meta property="article:modified_time" content="Sat Jul 16 2022 15:03:59 GMT+0800">
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:card" content="summary_large_image">

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="http://www.xjunz.top/post/DatabaseIPC/index.html" />
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "http://www.xjunz.top/post/DatabaseIPC/index.html",
    "headline": "How to Implement Inter-Process Database Communication Rid of ContentProvider?",
    "datePublished": "Sat Jul 16 2022 15:03:59 GMT+0800",
    "dateModified": "Sat Jul 16 2022 15:03:59 GMT+0800",
    "author": {
        "@type": "Person",
        "name": "xjunz",
        "image": {
            "@type": "ImageObject",
            "url": "/img/avatar.png"
        },
        "description": ""
    },
    "publisher": {
        "@type": "Organization",
        "name": "Me, xjunz&#39;s blog",
        "logo": {
            "@type":"ImageObject",
            "url": "/img/favicon.svg"
        }
    },
    "keywords": "",
    "description": "xjunz&#39;s blog",
}
</script>


    

    <!-- Analytics -->
    
    
    

    <!-- Custom Head -->
    
        
            
        
    
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="/custom_css_source.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.2.0"></head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span id="MD-burger-id" class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#How-to-implement-inter-process-database-communication-rid-of-ContentProvider"><span class="post-toc-text">How to implement inter-process database communication rid of ContentProvider?</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Begin-with-ContentProvider"><span class="post-toc-text">Begin with ContentProvider</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#How-to-transact-a-Cursor-inter-process"><span class="post-toc-text">How to transact a Cursor inter-process?</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Concepts"><span class="post-toc-text">Concepts</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#The-quite-straight-forward-idea"><span class="post-toc-text"># The quite straight-forward idea</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#How-the-Android-framework-does"><span class="post-toc-text"># How the Android framework does?</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Get-rid-of-ContentProvider"><span class="post-toc-text">Get rid of ContentProvider</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Be-careful-of-hidden-APIs"><span class="post-toc-text">Be careful of hidden APIs!</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#RemoteSQLiteDatabase"><span class="post-toc-text">RemoteSQLiteDatabase</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Conclusion"><span class="post-toc-text">Conclusion</span></a></li></ol></li></ol>
    </ul>
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        <!-- Custom Thumbnail -->
        <div class="post_thumbnail-custom mdl-card__media mdl-color-text--grey-50" style="background-image:url(/post/DatabaseIPC/thumbnail.png)">
    
            <p class="article-headline-p">
                How to Implement Inter-Process Database Communication Rid of ContentProvider?
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>xjunz</strong>
        <span>7月 16, 2022</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    
        <button id="article-functions-qrcode-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">devices other</i>
    <span class="visuallyhidden">devices other</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-qrcode-button">
    <li class="mdl-menu__item">在其它设备中阅读本文章</li>
    
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACbUlEQVR42u3aQXLjMAwEQP3/05vrXuQMAFJiOa2TK5Fttg4EPMT176uvCw8PDw8PDw8P7zDeFV//35+/Hi20uDY8PDy8J3nJ19y9vvua5BMmd97dg4eHh/ckb20xuPvkZNPvrQ0PDw/vTN68gU4AeHh4eN/Ey9vcamFIHgQeHh7eabz8B38vYkiKzctZCx4eHl7M23cANn999PkeHh7en+TND/XzMvP5kS0bOMDDw8PbzPvc2uZFIm+Ok3flx2nlXwx4eHh4Y14Cyw/7k7KRh7zJqgp1Dw8PD28DLxkUSJrgvKjkS18WRuDh4eFt4OXUavs7KUiF5hsPDw9vM6+6ZVdjgl4BqJYfPDw8vBN4Sfy6NtLNhxUKYQQeHh7eBt7a1rm3oN7wAR4eHt67vOoB2HxEIH+U+X/x8PDwnufl23G+9PkB2+LRATw8PLwxL2mXkzuTT0iOr6rloRzj4uHh4Y15k7A1iV+rEUY1jMDDw8N7i5eHEXnju68M4OHh4Z3Ay9vfVcFEtQUvxMR4eHh4m3mTKKG6cefv6gXEeHh4eE/yku24Nz6VbOWTAYIopcbDw8Pbxqtu63lh6IWz1WYaDw8P70neL1ttHMX2Rg2u+BpNRuDh4eEt4lWvZBSg10b3WvwopcbDw8NbyptsyvlfqhFD7+gLDw8P70leXgzyWKEa+PYGCPDw8PDe5VWP//MD/mo5yQcLmgdgeHh4eI/z8tA2CXl7I1+j0QE8PDy8B3mrItfJg8DDw8M7h1dtlKujA3k8kTx6PDw8vHd51QOwfNPPi031zo3ne3h4eHgfed934eHh4eHh4eHhHXD9AHEtKybo8FeSAAAAAElFTkSuQmCC">
    
</ul>

    

    <!-- Tags (bookmark) -->
    

    <!-- Share -->
    
        <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    
        
            <!-- Busuanzi Views -->
            <a class="post_share-link" href="#">
                <li class="mdl-menu__item">
                    <span id="busuanzi_container_page_pv">
                        <span id="busuanzi_value_page_pv"></span>&nbsp;浏览量
                    </span>
                </li>
            </a>
        
    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=How to Implement Inter-Process Database Communication Rid of ContentProvider?&url=http://www.xjunz.top/post/DatabaseIPC/index.html&pic=http://www.xjunz.top/img/favicon.svg&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=How to Implement Inter-Process Database Communication Rid of ContentProvider?&url=http://www.xjunz.top/post/DatabaseIPC/index.html&via=xjunz" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://www.xjunz.top/post/DatabaseIPC/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    
        <a class="post_share-link" href="http://connect.qq.com/widget/shareqq/index.html?site=Me, xjunz&#39;s blog&title=How to Implement Inter-Process Database Communication Rid of ContentProvider?&summary=xjunz&#39;s blog&pics=http://www.xjunz.top/img/favicon.svg&url=http://www.xjunz.top/post/DatabaseIPC/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 QQ
            </li>
        </a>
    

    <!-- Share Telegram -->
    
        <a class="post_share-link" href="https://telegram.me/share/url?url=http://www.xjunz.top/post/DatabaseIPC/index.html&text=How to Implement Inter-Process Database Communication Rid of ContentProvider?" target="_blank">
            <li class="mdl-menu__item">
                分享到 Telegram
            </li>
        </a>
    
</ul>

    
</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
            
         <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="How-to-implement-inter-process-database-communication-rid-of-ContentProvider"><a href="#How-to-implement-inter-process-database-communication-rid-of-ContentProvider" class="headerlink" title="How to implement inter-process database communication rid of ContentProvider?"></a>How to implement inter-process database communication rid of ContentProvider?</h1><blockquote>
<p>Most of us Android developers will never have an encounter with such a requirement like database IPC, because the Android framework has already provided an approach called <code>ContentProvider</code>. But do you know how it works and what if your server process is not even a standard Android application? That’s what we are going to talk about.</p>
</blockquote>
<h2 id="Begin-with-ContentProvider"><a href="#Begin-with-ContentProvider" class="headerlink" title="Begin with ContentProvider"></a>Begin with ContentProvider</h2><p>ContentProvider gives Android the capability of providing a variety of content between applications in a encapsulated and controlled way. This mechanism is so widely used from reading contacts from the phonebook to picking a image from the gallery. As a developer, if you’ve ever used a ContentProvider, you must have noticed that the ContentProvider framework provides a set of APIs, which are similar to the structural query language, although this does not mean that the provider must store its data in a relational database. You can refer to <a target="_blank" rel="noopener" href="https://developer.android.com/guide/topics/providers/content-providers">this page</a> to learn basics about ContentProvider. There are many types of data but in conclusion, two types: structured data and binary file data. For files, the data is queried by <code>ContentResolver.open*()</code> , where the caller can retrieve the stream or the file descriptor, so its IPC mechanism is <code>FileDescriptor</code> exposing. As for structural data, in most case, they are stored in a relational database like SQLite database. They can be queried by <code>ContentResolver.query()</code>, which returns a <code>Cursor</code> just like querying a local database.  It’s obvious that the cursor is the key of database IPC. Now what we want to know is how to transact a cursor in IPC.</p>
<h2 id="How-to-transact-a-Cursor-inter-process"><a href="#How-to-transact-a-Cursor-inter-process" class="headerlink" title="How to transact a Cursor inter-process?"></a>How to transact a Cursor inter-process?</h2><blockquote>
<p>What will you do if you are the designer of ContentProvider?</p>
</blockquote>
<h3 id="Concepts"><a href="#Concepts" class="headerlink" title="Concepts"></a>Concepts</h3><blockquote>
<p>To help your further reading, we need to clarify some simple concepts.</p>
</blockquote>
<ul>
<li><p><strong>The caller process</strong></p>
<p>The process who requires content.</p>
</li>
<li><p><strong>The callee process</strong></p>
<p>The process who provides content.</p>
</li>
</ul>
<h3 id="The-quite-straight-forward-idea"><a href="#The-quite-straight-forward-idea" class="headerlink" title="# The quite straight-forward idea"></a># The quite straight-forward idea</h3><p>The class <code>Cursor</code> is an interface defining a cursor’s behaviors and we don’t need to care about what is really running underneath. Upholding this concept, we may come up with a straight-forward idea, that is AIDL. We can simply define an AIDL mimicking the <code>Cursor</code> interface:</p>
<p> <strong>Note</strong>: To abridge the article, we will just pick several interfaces for the illustration:</p>
<pre><code class="java">// IRemoteCursor.aidl
interface IRemoteCursor &#123;
    int getCount();
    boolean moveToNext();
    // ...and so on
    void close();
&#125;
</code></pre>
<p>After a successful build, we can define a class called <code>RemoteCursor</code> inheriting from <code>Cursor</code> . It delegates the remote calls in the caller process.</p>
<pre><code class="kotlin">// RemoteCursor.kt
private class RemoteCursor(private val binder:IRemoteCursor):Cursor&#123;

    override fun getCount(): Int &#123;
        return binder.count
    &#125;

    override fun moveToNext(): Boolean &#123;
        return binder.moveToNext()
    &#125;
    
    // ...and so on
    
    override fun close() &#123;
        binder.close()
    &#125;
&#125;

/**
 * Reconstruct the cursor.
 */
fun IBinder.asCursor(): Cursor &#123;
    return RemoteCursor(RemoteCursor.Stub.asInterface(this))
&#125;
</code></pre>
<p>And also we need to do real work in the callee process.</p>
<pre><code class="kotlin">// RemoteCursorImpl.kt
private class RemoteCursorImpl(private val cursor:Cursor): IRemoteCursor.Stub() &#123;
    
    override fun getCount(): Int &#123;
        return cursor.count
    &#125;

    override fun moveToNext(): Boolean &#123;
        return cursor.moveToNext()
    &#125;
    
    // ...and so on
    
    override fun close() &#123;
        cursor.close()
    &#125;
&#125;

/**
 * Desconstruct the cursor.
 */
fun Cursor.asBinder(): IRemoteCursor &#123;
    return RemoteCursorImpl(this)
&#125;
</code></pre>
<p>Everything is done now. If we want to do a remote database query, we can just build <code>RemoteCursorImpl</code> from a normal cursor in the callee process and transact it as a binder to the caller process, where we can reconstruct the cursor as <code>RemoteCursor</code> from the binder. Everything seems perfect and working as expected, but there is a hidden performance issue.  If the table we were querying contains a large number of records and you would like it read it all, the performance issue would be very significant, because there were too many IPC calls and too many memory copies. The more rows and columns it contains, the more unbearable the performance issue will be,  which could finally lead to a performance disaster. </p>
<h3 id="How-the-Android-framework-does"><a href="#How-the-Android-framework-does" class="headerlink" title="# How the Android framework does?"></a># How the Android framework does?</h3><p>Let’s dive into the source code. In <a target="_blank" rel="noopener" href="https://cs.android.com/android/platform/superproject/+/master:frameworks/base/core/java/android/content/ContentProviderNative.java;"><code>ContentProviderNative</code></a>, where the real <code>ContentProvider</code> is implemented,  we will see how they construct the cursor from the callee process:</p>
<pre><code class="java">// ContentProviderNative.java
@Override
public Cursor query(@NonNull AttributionSource attributionSource, Uri url,
        @Nullable String[] projection, @Nullable Bundle queryArgs,
        @Nullable ICancellationSignal cancellationSignal)
        throws RemoteException &#123;
    BulkCursorToCursorAdaptor adaptor = new BulkCursorToCursorAdaptor();
    Parcel data = Parcel.obtain();
    Parcel reply = Parcel.obtain();
    try &#123;
        // ...
        mRemote.transact(IContentProvider.QUERY_TRANSACTION, data, reply, 0);
        // ...
        if (reply.readInt() != 0) &#123;
            BulkCursorDescriptor d = BulkCursorDescriptor.CREATOR.createFromParcel(reply);
            Binder.copyAllowBlocking(mRemote, (d.cursor != null) ? d.cursor.asBinder() : null);
            adaptor.initialize(d);
        &#125; else &#123;
            adaptor.close();
            adaptor = null;
        &#125;
        return adaptor;
    &#125; catch (RemoteException ex) &#123;
        adaptor.close();
        throw ex;
    &#125; catch (RuntimeException ex) &#123;
        adaptor.close();
        throw ex;
    &#125; finally &#123;
        data.recycle();
        reply.recycle();
    &#125;
&#125;
</code></pre>
<p>The final cursor returned is an instance of class <code>BulkCursorToCursorAdaptor</code>, which follows the adaptor design pattern. The <code>BulkCursorToCursorAdaptor</code> is initialized from a <code>BulkCursorDescriptor</code>, which is parcelable. So in the callee side, there must be something that converts a cursor into a <code>BulkCursorDescriptor</code> and transact it to the caller side and the caller side reconstructs the cursor with <code>BulkCursorToCursorAdaptor</code>. The idea seems just like what we’ve thought <a href="#">before</a>, but will this implementation fall into performance issue? Let’s take a look at what <code>BulkCursorToCursorAdaptor.initialize()</code> does:</p>
<pre><code class="java">// BulkCursorToCursorAdaptor.java
public void initialize(BulkCursorDescriptor d) &#123;
    mBulkCursor = d.cursor;
    mColumns = d.columnNames;
    mWantsAllOnMoveCalls = d.wantsAllOnMoveCalls;
    mCount = d.count;
    if (d.window != null) &#123;
        setWindow(d.window);
    &#125;
&#125;
</code></pre>
<p>This method simply assign fields from <code>BulkCursorDescriptor</code> to it’s member fields, but there is something new called <code>mBulkCursor</code>(an instance of <code>IBulkCursor</code>).  What is it? In <a target="_blank" rel="noopener" href="https://cs.android.com/android/platform/superproject/+/master:frameworks/base/core/java/android/database/IBulkCursor.java;">here</a>, we find that the <code>IBulkCursor</code> is an interface defines something similar to a cursor but much simpler. The most remarkable method is <code>getWindow()</code>, which returns a <code>CursorWindow</code>, while the <code>CursorWindow</code> is parcelable. Then everything seems to be clear. The essence of a cursor is its <code>CursorWindow</code>, we can reconstruct a cursor from a cursor window and some metadata. Now let’s find out how <code>getWindow()</code> is implemented. There is another adaptor called <code>CursorToBulkCursorAdaptor</code>, which yields a <code>BulkCursorDescriptor</code> from a normal cursor and is the real implementation of <code>IBulkCursor</code>:</p>
<pre><code class="java">// CursorToBulkCursorAdaptor.java
@Override
public CursorWindow getWindow(int position) &#123;
    synchronized (mLock) &#123;
        throwIfCursorIsClosed();

        if (!mCursor.moveToPosition(position)) &#123;
            closeFilledWindowLocked();
            return null;
        &#125;

        CursorWindow window = mCursor.getWindow();
        if (window != null) &#123;
            closeFilledWindowLocked();
        &#125; else &#123;
            window = mFilledWindow;
            if (window == null) &#123;
                mFilledWindow = new CursorWindow(mProviderName);
                window = mFilledWindow;
            &#125; else if (position &lt; window.getStartPosition()
                    || position &gt;= window.getStartPosition() + window.getNumRows()) &#123;
                window.clear();
            &#125;
            mCursor.fillWindow(position, window);
        &#125;

        if (window != null) &#123;
            // Acquire a reference to the window because its reference count will be
            // decremented when it is returned as part of the binder call reply parcel.
            window.acquireReference();
        &#125;
        return window;
    &#125;
&#125;
</code></pre>
<p>We can see that the cursor window is lazily filled via <code>mCursor.fillWindow(position, window)</code> as needed.  You might wonder what is a cursor window? As the documentation explained, a cursor window is</p>
<blockquote>
<p>A buffer containing multiple cursor rows.</p>
</blockquote>
<p>So once a cursor window is filled, the caller does not need to invoke IPC calls and do memory copies for each column and each row, which largely cuts down the time consumption and consequently gets freed from the performance issue. </p>
<h2 id="Get-rid-of-ContentProvider"><a href="#Get-rid-of-ContentProvider" class="headerlink" title="Get rid of ContentProvider"></a>Get rid of ContentProvider</h2><blockquote>
<p>Now that we’ve known the principle of cursor IPC, we can work on the database IPC without ContentProvider. We just need to mimics the Android framework. The following code snippets use SQLite database as an example.</p>
</blockquote>
<h3 id="Be-careful-of-hidden-APIs"><a href="#Be-careful-of-hidden-APIs" class="headerlink" title="Be careful of hidden APIs!"></a>Be careful of hidden APIs!</h3><p>You might think that we can just use those APIs like <code>IBulkCursor</code>  in the Android framework by reflection or linking. Yes, this may work but do rememeber that those are hidden apis and are not designed to be used by third-party apps, which are expected to be run in various devices, because their implementation varies on different Android releases or even on different ROMs. You’d better write(or just copy) the same codes in your project.</p>
<h3 id="RemoteSQLiteDatabase"><a href="#RemoteSQLiteDatabase" class="headerlink" title="RemoteSQLiteDatabase"></a>RemoteSQLiteDatabase</h3><p>Firstly, we need to abstract a remote sqlite database representing a sqlite database in the callee process to be used in caller process. Thanks to <code>androidx.sqlite</code>, they provide a fine abstraction of a sqlite database called <code>SupportSQLiteDatabase</code>. Now we just need to copy its interfaces into an AIDL file. There are a lot of interfaces, you can just count those necessary in. In our illustration, we will only show several interfaces.</p>
<pre><code class="java">// IRemoteSQLiteDatabase.aidl
interface IRemoteSQLiteDatabase &#123;
    void beginTransaction();
    void endTransaction();
    BulkCursorDescriptor query(String query,in String[] bindArgs);
    // ...and so on
    void close();
&#125;
</code></pre>
<p>You might notice that we return a <code>BulkCursorDecriptor</code> in <code>query</code> method, because the <code>BulkCursorDecriptor</code> is parcelable and contains all we need to rebuild a cursor. Don’t remember to import it. </p>
<pre><code class="java">// BulkCursorDescriptor.java
public final class BulkCursorDescriptor implements Parcelable &#123;
    public IBulkCursor cursor;
    public String[] columnNames;
    public boolean wantsAllOnMoveCalls;
    public int count;
    public CursorWindow window;
&#125;
</code></pre>
<p>Now what we need is <code>IBulkCursor</code>, we can define it in AIDL as well. </p>
<pre><code class="java">// IBulkCursor.aidl
interface IBulkCursor &#123;
    /**
     * Gets a cursor window that contains the specified position.
     * The window will contain a range of rows around the specified position.
     */
    CursorWindow getWindow(int position);

    /**
     * Notifies the cursor that the position has changed.
     * Only called when &#123;@link #getWantsAllOnMoveCalls()&#125; returns true.
     *
     * @param position The new position
     */
    void onMove(int position);

    void close();
&#125;
</code></pre>
<p>And there are <code>CursorToBulkCursorAdaptor</code> and <code>BulkCursorToCursorAdaptor</code>. I will no longer paste them here because I don’t want to make the article too long. They are simply copied from the Android framework source code with some small modifications. Now let’s combine these all in Kotlin codes.</p>
<pre><code class="kotlin">// RemoteSQLiteDatabase.kt
private class RemoteSQLiteDatabase(private val binder: IRemoteSQLiteDatabase) : SupportSQLiteDatabase &#123;
        
    override fun beginTransaction() &#123;
        binder.beginTransaction()
    &#125;       
        
    override fun endTransaction() &#123;
        binder.endTransaction()
    &#125;
        
   @Suppress(&quot;UNCHECKED_CAST&quot;)
    override fun query(query: String, bindArgs: Array&lt;out Any&gt;?): Cursor &#123;
        val descriptor = binder.query(query, bindArgs as? Array&lt;out String&gt;)
        return BulkCursorToCursorAdaptor().apply &#123;
            initialize(descriptor)
        &#125;
    &#125;
        
    // ...and so on
   
    override fun close() &#123;
        binder.close()
    &#125;

 &#125;

fun IBinder.asSupportSQLiteDatabase(): SupportSQLiteDatabase &#123;
    return RemoteSQLiteDatabase(IRemoteSQLiteDatabase.Stub.asInterface(this))
&#125;
</code></pre>
<p>In the query method body, we received a <code>BulkCursorDescriptor</code> from the callee process and wrap it into a <code>BulkCursorToCursorAdaptor</code>, which can be used as a normal cursor by the caller process. Now let’s do real query in the callee process.</p>
<pre><code class="kotlin">// RemoteSQLiteDatabaseImpl.kt
private class RemoteSQLiteDatabaseImpl(val database: SupportSQLiteDatabase) : IRemoteSQLiteDatabase.Stub() &#123;
    override fun beginTransaction() &#123;
        database.beginTransaction()
    &#125;
    
    override fun endTransaction() &#123;
        database.endTransaction()
    &#125;
    
    override fun query(query: String, args: Array&lt;out String&gt;?): BulkCursorDescriptor &#123;
        try &#123;
            val cursor = database.query(query, args)
            return CursorToBulkCursorAdaptor(cursor, &quot;name.for.cursor.window&quot;).bulkCursorDescriptor
        &#125; catch (e: Exception) &#123;
            // rethrow as IllegalStateException, which is supported by IPC.
            error(e)
        &#125;
    &#125;
    
    // ...and so on
    
    override fun close() &#123;
        database.close()
    &#125;
&#125;

fun SupportSQLiteDatabase.asBinder(): IRemoteSQLiteDatabase &#123;
     return RemoteSQLiteDatabaseImpl(this)
&#125;
</code></pre>
<p>Now what? How do we open an remote database from the caller process? Do it yourself.</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Once we get rid of ContentProvider, we can run this code in a pure Java process. Those guys who love magic may need this one day.</p>

        
                <blockquote style="margin: 2em 0 0;padding: 0.5em 1em;border-left: 3px solid #F44336;background-color: #F5F5F5;list-style: none;">
                    <p><strong>
                        
                            <a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a><br />本作品采用<a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。
                        </strong>
                        <br>
                        <strong>本文链接：</strong><a href="http://www.xjunz.top/post/DatabaseIPC/">http://www.xjunz.top/post/DatabaseIPC/</a>
                    </p>
                </blockquote>
        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
    <!-- 使用 DISQUS_CLICK -->
<div id="disqus-comment">
    <div id="disqus_thread"></div>

<!-- add animation -->
<style>
	.disqus_click_btn {
            line-height: 30px;
            margin: 0;
            min-width: 50px;
            padding: 0 14px;
            display: inline-block;
            font-family: "Roboto", "Helvetica", "Arial", sans-serif;
            font-size: 14px;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 0;
            overflow: hidden;
            will-change: box-shadow;
            transition: box-shadow .2s cubic-bezier(.4, 0, 1, 1), background-color .2s cubic-bezier(.4, 0, .2, 1), color .2s cubic-bezier(.4, 0, .2, 1);
            outline: 0;
            cursor: pointer;
            text-decoration: none;
            text-align: center;
            vertical-align: middle;
            border: 0;
            background: rgba(158, 158, 158, .2);
            box-shadow: 0 2px 2px 0 rgba(0, 0, 0, .14), 0 3px 1px -2px rgba(0, 0, 0, .2), 0 1px 5px 0 rgba(0, 0, 0, .12);
            color: #fff;
            background-color: #ff4e58;
            text-shadow: 0;
            display: none
        }
</style>
	
<div class="btn_click_load"> 
    <button class="disqus_click_btn">阅读评论（请确保 disqus 可以正常加载）</button>
</div>

<script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'http://www.xjunz.top/post/DatabaseIPC/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'http://www.xjunz.top/post/DatabaseIPC/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
</script>

<script type="text/ls-javascript" id="disqus-lazy-load-script">
    $.ajax({
        url: 'https://disqus.com/next/config.json',
        timeout: 4000,
        type: 'GET',
        success: (function() {
            var d = document;
            var s = d.createElement('script');
            s.src = '//www-xjunz-top.disqus.com/embed.js';
            s.setAttribute('data-timestamp', + new Date());
            (d.head || d.body).appendChild(s);
            $('.disqus_click_btn').css('display','none');
        })(),
        error: function() {
          $('.disqus_click_btn').css('display','block');
        }
    });
    $('.btn_click_load').click(function() {  //click to load comments
        (function() { // DON'T EDIT BELOW THIS LINE
            var d = document;
            var s = d.createElement('script');
            s.src = '//www-xjunz-top.disqus.com/embed.js';
            s.setAttribute('data-timestamp', + new Date());
            (d.head || d.body).appendChild(s);
        })();
        $('.disqus_click_btn').css('display','none');
    });
</script>
  	

</div>
<style>
    #disqus-comment{
        background-color: #eee;
        padding: 2pc;
    }
</style>

                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/post/RetroMaterialTheme/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="xjunz's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        1409122313@qq.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="mailto:1409122313@qq.com" target="_blank" title="Mailto">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Mailto
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2022/07/">七月 2022<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2022/03/">三月 2022<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2021/03/">三月 2021<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/04/">四月 2019<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                分类
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/Android-Dev/">Android Dev<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/Android-UI-UX/">Android UI/UX<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/%E6%9D%82%E8%B0%88/">杂谈<span class="sidebar_archives-count">2</span></a>
            </ul>
        </li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="/timeline" title="时•光">
                
                    <i class="material-icons sidebar-material-icons">history</i>
                
                时•光
            </a>
        </li>
        
    
        <li>
            <a href="/tags/trite" title="牙慧">
                
                    <i class="material-icons sidebar-material-icons">book</i>
                
                牙慧
            </a>
        </li>
        
    
        <li>
            <a href="/gallery" title="画廊">
                
                    <i class="material-icons sidebar-material-icons">local_florist</i>
                
                画廊
            </a>
        </li>
        
    
        <li>
            <a href="/about" title="关于">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                关于
            </a>
        </li>
        
            <li class="divider"></li>
        
    

    <!-- Article Number  -->
    
        <li>
            <a href="/archives">
                文章总数
                <span class="sidebar-badge">6</span>
            </a>
        </li>
        
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->


<!-- Help & Support -->
<!--

    <a href="mailto:ibh@live.com" class="sidebar-footer-text-a">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
        sidebar.help
        <span class="mdl-button__ripple-container">
          <span class="mdl-ripple"></span>
        </span>
      </div>
    </a>

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    

    <!-- Facebook -->
    

    <!-- Google + -->
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://github.com/xjunz" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-github">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    
        <a href="https://space.bilibili.com/124677178" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-bilibili">
                <span class="visuallyhidden">Bilibili</span>
            </button><!--
     --></a>
    

    <!-- Telegram -->
    
        <a href="https://t.me/xjunz" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-telegram">
                <span class="visuallyhidden">Telegram</span>
            </button><!--
     --></a>
    

    <!-- V2EX -->
    

    <!-- Segmentfault -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;<span year></span>&nbsp;Me, xjunz's blog
            
                <br>
                
                    <b>The confession of an average man</b>
                
            
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/bollnh/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","/js/lazyload.min.js?wgjW/HuQG9JDgvPDPoRAng==", true)</script>



    <script>lsloader.load("js_js","/js/js.min.js?LT4t6iE6m8TO1BLGGiNJqA==", true)</script>



    <script>lsloader.load("np_js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#ff4e58'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #ff4e58, 0 0 15px #ff4e58'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#ff4e58',
        'border-left-color': '#ff4e58'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>



    
        <script>lsloader.load("sm_js","/js/smoothscroll.js?tNQK2Tw2SUL8a1Scn/Mgew==", true)</script>
    





    <!-- Busuanzi -->
    <script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



   <!-- 使用 DISQUS js 代码 -->






<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('
<link rel="stylesheet" href="/css/uc.css">
');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Import prettify js  -->

    
        
            <script>lsloader.load("prettify_js","/js/prettify.min.js?WN07fivHQSMKWy7BmHBB6w==", true)</script>
        
    



<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
        
            $(function() {
                $('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto;');
                prettyPrint();
                })
        
    
    
</script>

<!-- MathJax Load-->


<!-- Bing Background -->

<script type="text/ls-javascript" id="Bing-Background-script">
    queue.offer(function(){
        $('body').attr('data-original', 'https://api.i-meto.com/bing?S');
    });
</script>


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->


    
        
    


<script>
    var copyrightNow = new Date().getFullYear();
    var textContent = document.querySelector('span[year]')

    copyrightSince = 2019;
    if (copyrightSince === copyrightNow||copyrightSince === 0000) {
        textContent.textContent = copyrightNow
    } else {
        textContent.textContent = copyrightSince + ' - ' + copyrightNow
    }

    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.5.6 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        </body>
    
</html>

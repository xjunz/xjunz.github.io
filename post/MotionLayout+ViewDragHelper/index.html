<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head>
    <meta charset="utf-8">
    <meta name="google-site-verification" content="Is5NCRh3gMI3ic8PKbNsXzLtoQu1b2ywfIoPhkv3JYA" />
    <!--
        © Material Theme
        https://github.com/bollnh/hexo-theme-material
        Version: 1.5.6 -->
    <script>
        window.materialVersion = "1.5.6"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1',
            '1.5.0',
            '1.5.2',
            '1.5.5'
        ]
    </script>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">



    <link rel="dns-prefetch" href="https://busuanzi.ibruce.info"/>



    <link rel="dns-prefetch" href="https://www-xjunz-top.disqus.com"/>





    <link rel="dns-prefetch" href="https://fonts.googleapis.com"/>





    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!-- Title -->
    
    <title>
        
            真的有这么丝滑吗？MotionLayout + ViewDragHelper绝赞组合! | 
        
        Me, xjunz&#39;s blog
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.svg">
    <link rel="icon" href="/img/favicon.svg">

    <meta name="format-detection" content="telephone=no"/>
    <meta name="description" itemprop="description" content="xjunz&#39;s blog">
    <meta name="keywords" content="">
    <meta name="theme-color" content="#ffc3ac">

    <!-- Disable Fucking Bloody Baidu Tranformation -->
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(a){try{localStorage.removeItem(a)}catch(b){}};lsloader.setLS=function(a,c){try{localStorage.setItem(a,c)}catch(b){}};lsloader.getLS=function(a){var c="";try{c=localStorage.getItem(a)}catch(b){c=""}return c};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var b=[];for(var a=0;a<localStorage.length;a++){b.push(localStorage.key(a))}b.forEach(function(e){var f=lsloader.getLS(e);if(window.oldVersion){var d=window.oldVersion.reduce(function(g,h){return g||f.indexOf("/*"+h+"*/")!==-1},false);if(d){lsloader.removeLS(e)}}})}catch(c){}};lsloader.clean();lsloader.load=function(f,a,b,d){if(typeof b==="boolean"){d=b;b=undefined}d=d||false;b=b||function(){};var e;e=this.getLS(f);if(e&&e.indexOf(versionString)===-1){this.removeLS(f);this.requestResource(f,a,b,d);return}if(e){var c=e.split(versionString)[0];if(c!=a){console.log("reload:"+a);this.removeLS(f);this.requestResource(f,a,b,d);return}e=e.split(versionString)[1];if(d){this.jsRunSequence.push({name:f,code:e});this.runjs(a,f,e)}else{document.getElementById(f).appendChild(document.createTextNode(e));b()}}else{this.requestResource(f,a,b,d)}};lsloader.requestResource=function(b,e,a,c){var d=this;if(c){this.iojs(e,b,function(h,f,g){d.setLS(f,h+versionString+g);d.runjs(h,f,g)})}else{this.iocss(e,b,function(f){document.getElementById(b).appendChild(document.createTextNode(f));d.setLS(b,e+versionString+f)},a)}};lsloader.iojs=function(d,b,g){var a=this;a.jsRunSequence.push({name:b,code:""});try{var f=new XMLHttpRequest();f.open("get",d,true);f.onreadystatechange=function(){if(f.readyState==4){if((f.status>=200&&f.status<300)||f.status==304){if(f.response!=""){g(d,b,f.response);return}}a.jsfallback(d,b)}};f.send(null)}catch(c){a.jsfallback(d,b)}};lsloader.iocss=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.iofonts=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.runjs=function(f,c,e){if(!!c&&!!e){for(var b in this.jsRunSequence){if(this.jsRunSequence[b].name==c){this.jsRunSequence[b].code=e}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var a=document.createElement("script");a.appendChild(document.createTextNode(this.jsRunSequence[0].code));a.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(a);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else{if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var d=this;var a=document.createElement("script");a.src=this.jsRunSequence[0].path;a.type="text/javascript";this.jsRunSequence[0].status="loading";a.onload=function(){d.jsRunSequence.shift();if(d.jsRunSequence.length>0){d.runjs()}};document.body.appendChild(a)}}};lsloader.tagLoad=function(b,a){this.jsRunSequence.push({name:a,code:"",path:b,status:"failed"});this.runjs()};lsloader.jsfallback=function(c,b){if(!!this.jsnamemap[b]){return}else{this.jsnamemap[b]=b}for(var a in this.jsRunSequence){if(this.jsRunSequence[a].name==b){this.jsRunSequence[a].code="";this.jsRunSequence[a].status="failed";this.jsRunSequence[a].path=c}}this.runjs()};lsloader.cssfallback=function(e,c,b){if(!!this.cssnamemap[c]){return}else{this.cssnamemap[c]=1}var d=document.createElement("link");d.type="text/css";d.href=e;d.rel="stylesheet";d.onload=d.onerror=b;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(d,a)};lsloader.runInlineScript=function(c,b){var a=document.getElementById(b).innerText;this.jsRunSequence.push({name:c,code:a});this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Import CSS -->
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","/css/material.min.css?Z7a72R1E4SxzBKR/WGctOA==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","/css/style.min.css?uVzgA6RLrOm13Ukw8Qgy+A==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        
            
                <style id="prettify_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_css","/css/prettify.min.css?zp8STOU9v89XWFEnN+6YmQ==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
                <style id="prettify_theme"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_theme","/css/prettify/github-v2.min.css?AfzKxt++K+/lhZBlSjnxwg==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
            
        

    
    <style id="xjunz-mod_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("xjunz-mod_css","/css/xjunz-mod.css?devRGCHXAlT1zYNWGku0fQ==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

    

    <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Noto Serif SC, Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "微软雅黑", "Microsoft YaHei", Arial, sans-serif;
    overflow-x: hidden !important;
  }
  
  code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    letter-spacing: .0em !important;
  }

  a {
    color: #ff4e58;
    letter-spacing: .1em;
  }

  p.article-headline-p{
   font-family: Roboto !important;
  }

  p {
    letter-spacing: .15em;
    font-family: Noto Serif SC !important;
  }

  div {
    letter-spacing: .15em;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #ff4e58 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #ff4e58 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #ff4e58 !important;
  }

  .toTop {
    background: #ff4e58 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #ff4e58;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #ff4e58;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #ff4e58;
  }

  .post-toc a:hover {
    color: #ff4e58;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body {
        background-color: #faf2f1;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text {
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->
<!-- Import Roboto -->

    <!-- "https://fonts.googleapis.com/css?family=Roboto:300,400,500" -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC&display=swap" rel="stylesheet">




<!-- Import Material Icons -->


    <style id="material_icons"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_icons","/css/material-icons.css?pqhB/Rd/ab0H2+kZp0RDmw==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>




    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","/js/jquery.min.js?ezyEvm8ST5CGfpA+kFFi1g==", true)</script>
    

    <!-- WebAPP Icons -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Me, xjunz&#39;s blog">
    <meta name="msapplication-starturl" content="http://www.xjunz.top/post/MotionLayout+ViewDragHelper/">
    <meta name="msapplication-navbutton-color" content="#ffc3ac">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Me, xjunz&#39;s blog">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="/img/favicon.svg">

    <!-- Site Verification -->
    
    

    <!-- RSS -->
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://www.xjunz.top/post/MotionLayout+ViewDragHelper/">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="真的有这么丝滑吗？MotionLayout + ViewDragHelper绝赞组合! | Me, xjunz&#39;s blog">
    <meta property="og:image" content="/img/favicon.svg">
    <meta property="og:description" content="xjunz&#39;s blog">
    

    
        <meta property="article:published_time" content="Wed Mar 10 2021 09:34:18 GMT+0800">
        <meta property="article:modified_time" content="Sat Apr 02 2022 07:34:20 GMT+0800">
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:card" content="summary_large_image">

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="http://www.xjunz.top/post/MotionLayout+ViewDragHelper/index.html" />
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "http://www.xjunz.top/post/MotionLayout+ViewDragHelper/index.html",
    "headline": "真的有这么丝滑吗？MotionLayout + ViewDragHelper绝赞组合!",
    "datePublished": "Wed Mar 10 2021 09:34:18 GMT+0800",
    "dateModified": "Sat Apr 02 2022 07:34:20 GMT+0800",
    "author": {
        "@type": "Person",
        "name": "xjunz",
        "image": {
            "@type": "ImageObject",
            "url": "/img/avatar.png"
        },
        "description": ""
    },
    "publisher": {
        "@type": "Organization",
        "name": "Me, xjunz&#39;s blog",
        "logo": {
            "@type":"ImageObject",
            "url": "/img/favicon.svg"
        }
    },
    "keywords": "",
    "description": "xjunz&#39;s blog",
}
</script>


    

    <!-- Analytics -->
    
    
    

    <!-- Custom Head -->
    
        
            
        
    
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="/custom_css_source.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.2.0"></head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span id="MD-burger-id" class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#MotionLayout-ViewDragHelper-%E7%BB%9D%E8%B5%9E%E7%BB%84%E5%90%88"><span class="post-toc-text">MotionLayout + ViewDragHelper 绝赞组合!</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%89%8D%E8%A8%80"><span class="post-toc-text">前言</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%95%88%E6%9E%9C%E9%A2%84%E8%A7%88"><span class="post-toc-text">效果预览</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E9%9C%80%E6%B1%82%E5%AE%9E%E7%8E%B0%E5%88%86%E6%9E%90"><span class="post-toc-text">需求实现分析</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#MotionLayout%E7%AE%80%E4%BB%8B"><span class="post-toc-text">MotionLayout简介</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#ViewDragHelper%E7%AE%80%E4%BB%8B"><span class="post-toc-text">ViewDragHelper简介</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="post-toc-text">准备工作</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E9%85%8D%E7%BD%AEMotionLayout%E5%B8%83%E5%B1%80"><span class="post-toc-text">配置MotionLayout布局</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%BD%BF%E7%94%A8ViewDragHelper"><span class="post-toc-text">使用ViewDragHelper</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%85%B6%E4%BB%96%E5%86%B7%E7%9F%A5%E8%AF%86"><span class="post-toc-text">其他冷知识</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%A6%82%E4%BD%95%E6%B8%90%E5%8F%98%E5%9C%86%E8%A7%92%EF%BC%9F"><span class="post-toc-text">如何渐变圆角？</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#MaterialShapeDrawable"><span class="post-toc-text">MaterialShapeDrawable</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Custom-Attributes"><span class="post-toc-text">Custom Attributes</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%A6%82%E4%BD%95%E6%B8%90%E5%8F%98%E7%8A%B6%E6%80%81%E6%A0%8F%E9%A2%9C%E8%89%B2"><span class="post-toc-text">如何渐变状态栏颜色?</span></a></li></ol></li></ol></li></ol>
    </ul>
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        <!-- Custom Thumbnail -->
        <div class="post_thumbnail-custom mdl-card__media mdl-color-text--grey-50" style="background-image:url(/post/MotionLayout+ViewDragHelper/thumbnail.png)">
    
            <p class="article-headline-p">
                真的有这么丝滑吗？MotionLayout + ViewDragHelper绝赞组合!
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>xjunz</strong>
        <span>3月 10, 2021</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    
        <button id="article-functions-qrcode-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">devices other</i>
    <span class="visuallyhidden">devices other</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-qrcode-button">
    <li class="mdl-menu__item">在其它设备中阅读本文章</li>
    
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPYAAAD2CAAAAADAeSUUAAAC3UlEQVR42u3aQW7jQAwEwPz/09kHBFa6SW+iaEonw5ClqfGBYHM+Po+8PrCxsbGxsbGxsbFvyf6Ir6/3f31OvZQXv3r13tmasbGxsU9g54ubbcH1W17df/3edkOxsbGxT2BfF63rMpPjr79/dc9+zdjY2NjY+ed9ybkuk9jY2NjYbygGi+ApKU7J87GxsbGxVwFNWbrypiW/50ezNGxsbOzbs9tB7x0+/8J8GxsbG/uW7Nkhm02zMTu4MzsShI2NjX0COwni29Fv0qK0v5o1P9jY2NgnsGev3xysace6bbD1cnOxsbGxH82+ZiStwuybPBKa/VXY2NjY57Bb/KycFEssY6aooGJjY2M/mt2OVPNR8abx2BS/KFTCxsbGfhB7FgPNRgtJVDRrZr55MjY2NvZD2cnPNot+V0uzGfFiY2Njn8BOSk4b3+dDhTZIajcXGxsb+9nsN4Q1cfMwK0uzxqmeb2NjY2P/WXYS6CdFqD24udmydgyMjY2NfQI7D49acL4Rs00pWh1sbGzsh7Lz0emmdWkP8czK3jdbj42NjX0Ae1Zg2oM1swZmNoTAxsbGPoFdj0vjWCffjncd1sHGxsY+k73BzJ7TbnEbgQ3n29jY2Nh/nJ2PVPOltwVmP5AoBr3Y2NjYj2a/a6ybbFx+uCffXGxsbOwz2Zty1S40QeZjhvxYDzY2NvY57CRCymOmNjaaDSf+y0klbGxs7D/C3jz6+s68aP3QsAEbGxv7oexNqDSLkNpGIm9C6rqNjY2N/Th2crUHa9rxbd4O1QUYGxsb+6HsffiexPrJne1ANy+K2NjY2Cew86KVhEFtudq8K1k/NjY29jnsWRuQtxOblubNoRI2Njb2wexZoJ8XuX0UVc+3sbGxsbFHAVMyKt4EUj9UwLCxsbFvxm6Hu+3xnbblmDU/2NjY2GeyN4PepKi0BaxtS35hvo2NjY19G/Y5FzY2NjY2NjY2NvZtrn+1+yCCRz6nMQAAAABJRU5ErkJggg==">
    
</ul>

    

    <!-- Tags (bookmark) -->
    

    <!-- Share -->
    
        <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    
        
            <!-- Busuanzi Views -->
            <a class="post_share-link" href="#">
                <li class="mdl-menu__item">
                    <span id="busuanzi_container_page_pv">
                        <span id="busuanzi_value_page_pv"></span>&nbsp;浏览量
                    </span>
                </li>
            </a>
        
    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=真的有这么丝滑吗？MotionLayout + ViewDragHelper绝赞组合!&url=http://www.xjunz.top/post/MotionLayout+ViewDragHelper/index.html&pic=http://www.xjunz.top/img/favicon.svg&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=真的有这么丝滑吗？MotionLayout + ViewDragHelper绝赞组合!&url=http://www.xjunz.top/post/MotionLayout+ViewDragHelper/index.html&via=xjunz" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://www.xjunz.top/post/MotionLayout+ViewDragHelper/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    
        <a class="post_share-link" href="http://connect.qq.com/widget/shareqq/index.html?site=Me, xjunz&#39;s blog&title=真的有这么丝滑吗？MotionLayout + ViewDragHelper绝赞组合!&summary=xjunz&#39;s blog&pics=http://www.xjunz.top/img/favicon.svg&url=http://www.xjunz.top/post/MotionLayout+ViewDragHelper/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 QQ
            </li>
        </a>
    

    <!-- Share Telegram -->
    
        <a class="post_share-link" href="https://telegram.me/share/url?url=http://www.xjunz.top/post/MotionLayout+ViewDragHelper/index.html&text=真的有这么丝滑吗？MotionLayout + ViewDragHelper绝赞组合!" target="_blank">
            <li class="mdl-menu__item">
                分享到 Telegram
            </li>
        </a>
    
</ul>

    
</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
            
         <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="MotionLayout-ViewDragHelper-绝赞组合"><a href="#MotionLayout-ViewDragHelper-绝赞组合" class="headerlink" title="MotionLayout + ViewDragHelper 绝赞组合!"></a>MotionLayout + ViewDragHelper 绝赞组合!</h1><blockquote>
<p>内容可能存在错误或疏漏，欢迎批评斧正…</p>
</blockquote>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>目前各大视频、音乐播放器都有小窗（折叠）和全屏（展开）模式。但是对我而言，一直没找到任何一个产品能完美地通过用户交互在这两个模式之间优雅地过渡，唯一差强人意的是YouTube移动客户端。但是它对用户手指松开后的动画处理仍然不够自然。所以我思考着能不能自己实现一个。</p>
<h2 id="效果预览"><a href="#效果预览" class="headerlink" title="效果预览"></a>效果预览</h2><div align="center"> <img src="/post/MotionLayout+ViewDragHelper/preview.gif"> </div>

<hr>
<p>上面时我实现后的成品，展示了一个可根据用户拖动而在小窗和全屏之间过渡的音乐播放器。可以看到，无论是交互还是动画，都非常自然，也没有过度设计导致的低效。</p>
<h2 id="需求实现分析"><a href="#需求实现分析" class="headerlink" title="需求实现分析"></a>需求实现分析</h2><p>对于这样的需求，我首先想到的就是使用<code>ViewDragHelper</code>，因为它可以自然地处理手势拖拽。然后根据拖拽的比例设置控件的属性从而实现动画效果。但是这个界面上控件如此之多，其位置、大小、透明度、颜色、可见性乃至圆角大小都在变化，且不考虑工作量问题，就算实现了可维护性也非常糟糕。如果中途需求更改，某处要添加、移除一个控件，或者更换某个控件的动画效果，都是会牵一发而动全身的。这就是我们为什么要引入<code>MotionLayout</code>，因为它可以声明式地实现两个布局之间的过渡动画。其实，<code>MotionLayout</code>本身也可以通过<code>&lt;OnSwipe/&gt;</code>标签实现手势拖拽，但是效果真的差强人意，因为它无法实现像<code>ViewDragHelper</code>一样，当手指松开后，自然地过渡到结束状态。只有<code>linear</code>、<code>accelerate</code>、<code>decelerate</code>三种插值选项。所以我们还是使用<code>ViewDragHelper</code>处理手势。</p>
<h2 id="MotionLayout简介"><a href="#MotionLayout简介" class="headerlink" title="MotionLayout简介"></a>MotionLayout简介</h2><blockquote>
<p><strong>MotionLayout</strong> is intended to move, resize, and animate UI elements with which <strong>users interact</strong>, such as buttons and title bars. Motion in your app should <strong>not</strong> be simply a gratuitous special effect in your application. It should be used to help users understand what your application is doing. </p>
</blockquote>
<p><code>MotionLayout</code>是谷歌 I&#x2F;O 2018引入<strong>Material Design 2</strong>后不久推出的旨在实现丝滑交互动画的布局组件。官方设计指南特别强调，<code>MotionLayout</code>的存在不是为了简单的动画特效，而是为了处理与<strong>User Interact</strong>相关的UI过渡。它对动画的实现完全是声明式的，即你只需要声明动画的开始、结束状态、关键帧等，而不需要考虑动画的具体实现。它还内置各种效果超赞的<code>PathMotion</code>和插值器，Android Studio还提供可视化编辑器的支持<del>（实际体验并不是很友好）</del>。那么，这么强大的东西学习成本是不是很高？这里打个预防针，要实现我们的需求，并不需要对<code>MotionLayout</code>有深入的了解，掌握一些基础用法就足够了。</p>
<h2 id="ViewDragHelper简介"><a href="#ViewDragHelper简介" class="headerlink" title="ViewDragHelper简介"></a>ViewDragHelper简介</h2><p><code>ViewDragHelper</code>年代可就久远了，早在支持库年代就有了，大约可以追溯到2015年，MD一代推出之后。它的作用就如它的名字一样，帮助实现控件拖拽，网上的教程也是多如牛毛。我们会在下面的代码中介绍如何使用这玩意儿，使用起来也并不复杂。</p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>首先在你的项目中引入：</p>
<pre><code class="groovy">// 内置ViewDragHelper
implementation &#39;androidx.appcompat:appcompat:1.2.0&#39;
// 须2.0+版本，内置MotionLayout
implementation &#39;com.android.support.constraint:constraint-layout:2.0.4&#39;
</code></pre>
<h2 id="配置MotionLayout布局"><a href="#配置MotionLayout布局" class="headerlink" title="配置MotionLayout布局"></a>配置MotionLayout布局</h2><p>首先，我们新建一个布局文件，命名为<code>fragment_player.xml</code>。为了解耦，我们使用<code>Fragment</code>，将播放器界面与主界面分开。打开此布局文件，可以看到默认根布局是<code>ConstranitLayout</code>，我们进入design模式，选中我们的根布局后单击鼠标右键。可以看到，有一个选项：<strong>Convert to MotionLayout</strong>：</p>
<img src="/post/MotionLayout+ViewDragHelper/image-20210310123457587.png" alt="image-20210310123457587">

<p>点击后，可以发现我们布局的根节点变成了<code>MotionLayout</code>，并且自动添加了一个<code>app:layoutDescription</code>属性，该属性指向了一个<code>fragment_player_scene.xml</code>文件。没错，这个文件就是用于声明动画的，点进去：</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;MotionScene
    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:motion=&quot;http://schemas.android.com/apk/res-auto&quot;&gt;

    &lt;Transition
        motion:constraintSetEnd=&quot;@+id/end&quot;
        motion:constraintSetStart=&quot;@id/start&quot;
        motion:duration=&quot;1000&quot;&gt;
       &lt;KeyFrameSet&gt;
       &lt;/KeyFrameSet&gt;
    &lt;/Transition&gt;

    &lt;ConstraintSet android:id=&quot;@+id/start&quot;&gt;
    &lt;/ConstraintSet&gt;

    &lt;ConstraintSet android:id=&quot;@+id/end&quot;&gt;
    &lt;/ConstraintSet&gt;
&lt;/MotionScene&gt;
</code></pre>
<p>其中<code>Transition</code>节点定义了过渡动画的起始场景、结束场景、关键帧等；<code>ConstraintSet</code>节点则用于存放视图约束条件，这是什么意思呢？往后看。</p>
<p>接下来，我们试着往<code>MotionLayout</code>中增加一个<code>View</code>，用作播放器的背景。等等，你是不是有疑惑，为什么背景不直接设置<code>android:background</code>属性在<code>MotionLayout</code>上呢？是这样的，因为<code>MotionLayout</code>只支持其<strong>直接子View</strong>进行动画，而<code>MotionLayout</code>本身要求高度为<code>match_parent</code>，我们才能实现全屏的效果。所以既要支持背景动画，又要保证能全屏，我们就需要使用一个<code>View</code>来作为背景。</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;!--
  ~ Copyright (c) 2021 xjunz. All Rights Reserved.
  --&gt;
&lt;androidx.constraintlayout.motion.widget.MotionLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    app:layoutDescription=&quot;@xml/sample_scene&quot;&gt;

    &lt;View
        android:id=&quot;@+id/player_background&quot;
        android:background=&quot;#333&quot;
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot; /&gt;
&lt;/androidx.constraintlayout.motion.widget.MotionLayout&gt;
</code></pre>
<p>接下来，进入布局编辑器的design模式，可以看到<code>MotionLayout</code>的可视化编辑器，我们试着体验一下。</p>
<img src="/post/MotionLayout+ViewDragHelper/image-20210310132816444.png" alt="image-20210310132816444" style="zoom:67%;">

<p>可以看到，右上有两个分别标着“start”和“end”的矩形页面，这就是我们<code>fragment_player_scene.xml</code>中定义的两个<code>Transition</code>节点的id。下方，可以编辑<code>ConstrantSet</code>。我们先选中”start“页面，再选中下方的<code>player_background</code>，然后点击红色方框中的按钮，选择<img src="/post/MotionLayout+ViewDragHelper/image-20210310132922715.png" alt="image-20210310132922715" style="zoom:67%;"></p>
<p>就可以在右侧工具栏像使用<code>ConstraintLayout</code>一样设置约束了。</p>
<img src="/post/MotionLayout+ViewDragHelper/image-20210310133032363.png" alt="image-20210310133032363" style="zoom:67%;">

<p>我们把背景约束到布局底部，然后宽度设为<code>match_parent</code>，高度设为<code>?actionBarSize</code> (Action Bar的高度)。</p>
<img src="/post/MotionLayout+ViewDragHelper/image-20210310133532255.png" alt="image-20210310133532255" style="zoom:67%;">

<p>设置完之后，再查看XML代码，发现诶？好奇怪，怎么XML没变化？是的，与<code>ConstraintLayout</code>不同的是，对View设置的所有约束都需要在<code>scene</code>文件中定义，而不是在<code>MotionLayout</code>中定义，编辑器已经自动帮我们重定向到<code>fragment_player_scene.xml</code>了：</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;MotionScene xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:motion=&quot;http://schemas.android.com/apk/res-auto&quot;&gt;

    &lt;Transition
        motion:constraintSetEnd=&quot;@+id/end&quot;
        motion:constraintSetStart=&quot;@id/start&quot;
        motion:duration=&quot;1000&quot;&gt;
        &lt;KeyFrameSet&gt;

        &lt;/KeyFrameSet&gt;
    &lt;/Transition&gt;

    &lt;ConstraintSet android:id=&quot;@+id/start&quot;&gt;
        &lt;!-- 约束节点 --&gt;
        &lt;Constraint
            android:id=&quot;@+id/player_background&quot;
            android:layout_width=&quot;match_parent&quot;
            android:layout_height=&quot;?actionBarSize&quot;
            motion:layout_constraintBottom_toBottomOf=&quot;parent&quot; /&gt;
    &lt;/ConstraintSet&gt;

    &lt;ConstraintSet android:id=&quot;@+id/end&quot;&gt;
        
    &lt;/ConstraintSet&gt;
&lt;/MotionScene&gt;
</code></pre>
<p>这样<code>player_background</code>的初始约束就完成了。同理，当我们选中“end”页面，再为其添加结束约束：</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;MotionScene xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:motion=&quot;http://schemas.android.com/apk/res-auto&quot;&gt;

    &lt;Transition
        motion:constraintSetEnd=&quot;@+id/end&quot;
        motion:constraintSetStart=&quot;@id/start&quot;
        motion:duration=&quot;1000&quot;&gt;
        &lt;KeyFrameSet&gt;

        &lt;/KeyFrameSet&gt;
    &lt;/Transition&gt;

    &lt;ConstraintSet android:id=&quot;@+id/start&quot;&gt;
        &lt;Constraint
            android:id=&quot;@+id/player_background&quot;
            android:layout_width=&quot;match_parent&quot;
            android:layout_height=&quot;?actionBarSize&quot;
            motion:layout_constraintBottom_toBottomOf=&quot;parent&quot; /&gt;
    &lt;/ConstraintSet&gt;

    &lt;ConstraintSet android:id=&quot;@+id/end&quot;&gt;
        &lt;Constraint
            android:id=&quot;@+id/player_background&quot;
            android:layout_width=&quot;match_parent&quot;
            android:layout_height=&quot;wrap_content&quot;
            motion:layout_constraintTop_toTopOf=&quot;parent&quot;
            motion:layout_constraintBottom_toBottomOf=&quot;parent&quot; /&gt;
    &lt;/ConstraintSet&gt;
&lt;/MotionScene&gt;
</code></pre>
<p>此时回到可视化编辑器：</p>
<img src="/post/MotionLayout+ViewDragHelper/image-20210310135030327.png" alt="image-20210310135030327" style="zoom:67%;">

<p>先点击上方红色框部分，再点击播放按钮，就可以预览我们的动画了!</p>
<img src="/post/MotionLayout+ViewDragHelper/GIF 2021-3-10 13-55-30.gif" alt="GIF 2021-3-10 13-55-30" style="zoom: 67%;">

<p>除了约束可以被动画以外，我们还可以设置各种<code>transform</code>属性:</p>
<p><img src="/post/MotionLayout+ViewDragHelper/image-20210310135806189.png" alt="image-20210310135806189"></p>
<p>甚至是可见性<code>visibility</code>，<code>MotionLayou</code>t也会自动使用透明度动画来过渡。除此之外，还支持<strong>View Transition</strong>属性，和自定义<strong>Attributes</strong>：</p>
<p><img src="/post/MotionLayout+ViewDragHelper/image-20210310140143967.png" alt="image-20210310140143967"></p>
<p>这些用法可以参考官方文档或网上的博文，本人不再赘述，因为这不是重点。</p>
<p>现在如果你在<code>Transition</code>节点下使用<code>OnSwipe</code>标签：</p>
<pre><code class="xml">&lt;MotionScene xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:motion=&quot;http://schemas.android.com/apk/res-auto&quot;&gt;

    &lt;Transition
        motion:constraintSetEnd=&quot;@+id/end&quot;
        motion:constraintSetStart=&quot;@id/start&quot;
        motion:duration=&quot;1000&quot;&gt;
        &lt;OnSwipe
            motion:dragDirection=&quot;dragUp&quot;
            motion:touchAnchorId=&quot;@id/player_background&quot;
            motion:touchAnchorSide=&quot;top&quot; /&gt;
    &lt;/Transition&gt;
    ...
&lt;/MotionScene&gt;
</code></pre>
<p>就可以在“start”和“end”约束之间拖动<code>player_background</code>。但是如我前面所言，<code>MotionLayout</code>自带的拖动释放效果非常拉跨，我们需要使用<code>ViewDagHelper</code>来配合。</p>
<h2 id="使用ViewDragHelper"><a href="#使用ViewDragHelper" class="headerlink" title="使用ViewDragHelper"></a>使用ViewDragHelper</h2><p>新建一个类<code>PlayerLayout</code>，继承自<code>MotionLayout</code>，并在其中初始化<code>ViewDragHelper</code>:</p>
<pre><code class="java">public class PlayerLayout extends MotionLayout &#123;
    private ViewDragHelper mHelper;
    private ViewDragHelper.Callback mCallback;
    /**
     * Background view
     */
    private View mBackground;
    /**
     * Background view在折叠时候的Top
     */
    private int mTopWhenCollapsed;
    /**
     * Background view在折叠时候的高度
     */
    private int mHeightWhenCollapsed;


    public PlayerLayout(@NonNull Context context, @Nullable AttributeSet attrs) &#123;
        super(context, attrs);
        init();
    &#125;

    public PlayerLayout(@NonNull Context context) &#123;
        super(context);
        init();
    &#125;

    public PlayerLayout(@NonNull Context context, @Nullable AttributeSet attrs, int defStyleAttr) &#123;
        super(context, attrs, defStyleAttr);
        init();
    &#125;

    private void init() &#123;
        mHelper = ViewDragHelper.create(this, mCallback);
        OneShotPreDrawListener.add(this, () -&gt; &#123;
            // 在这里获取Top和Height
            mTopWhenCollapsed = mBackground.getTop();
            mHeightWhenCollapsed = mBackground.getHeight();
        &#125;);
    &#125;
    
     @Override
    protected void onSizeChanged(int w, int h, int oldw, int oldh) &#123;
        super.onSizeChanged(w, h, oldw, oldh);
        // 当布局大小改变时(如软键盘弹起)，更新Top
        mTopWhenCollapsed = h - mHeightWhenCollapsed;
    &#125;
    
    @Override
    protected void onFinishInflate() &#123;
        super.onFinishInflate();
        mBackground = findViewById(R.id.player_background);
    &#125;
    
    
    @Override
    public boolean onInterceptTouchEvent(@NotNull MotionEvent event) &#123;
        // 让Helper判断是否应该切断事件
        return mHelper.shouldInterceptTouchEvent(event);
    &#125;
    
    @SuppressLint(&quot;ClickableViewAccessibility&quot;)
    @Override
    public boolean onTouchEvent(@NotNull MotionEvent event) &#123;
        // 这里判断一下Helper是否处于拖拽状态，拖拽状态就返回true消耗掉
        // 不是的话将事件传递下去交给其他View处理，否则MotionLayout会
        // block掉整个屏幕的触摸事件
        mHelper.processTouchEvent(event);
        boolean block = mHelper.getCapturedView() != null;
        // 拖动的时候禁止打断（ACTION_CANCEL）
        requestDisallowInterceptTouchEvent(block);
        return block;
    &#125;
&#125;
</code></pre>
<p>上面很多代码是<code>ViewDragHelper</code>固定的用法，有不懂的可以看注释。<code>mTopWhenCollapsed</code>后面会用到。我们还有一个<code>mCallback</code>变量未初始化，因为这个比较重要，单独拿出来：</p>
<pre><code class="java">mCallback = new ViewDragHelper.Callback() &#123;

    @Override
    public boolean tryCaptureView(@NonNull View child, int pointerId) &#123;
        // 在这里定义允许哪个子视图拖动
        // 我们允许MotionLayout中的所有子视图拖动
        return true;
    &#125;

    @Override
    public void onViewCaptured(@NonNull View capturedChild, int activePointerId) &#123;
        super.onViewCaptured(capturedChild, activePointerId);
        try &#123;
            // 因为MotionLayout只支持其直接子视图的动画，而我们需要允许所有子视图拖动
            // 这样的话，就需要处理非常多的View的拖动，因此重定向我们的&#39;mCapturedChild&#39;
            // 到Background view, 这样就只要处理一个View就够了
            Field capturedViewField = mHelper.getClass().getDeclaredField(&quot;mCapturedView&quot;);
            capturedViewField.setAccessible(true);
            capturedViewField.set(mHelper, mBackground);
        &#125; catch (NoSuchFieldException | IllegalAccessException e) &#123;
            // Ho hum
        &#125;
    &#125;

    @Override
    public void onViewPositionChanged(@NonNull View changedView, int left, int top, int dx, int dy) &#123;
        super.onViewPositionChanged(changedView, left, top, dx, dy);
        if (dy == 0) &#123;
            return;
        &#125;
        // 当Background view拖动位置改变时，我们获取其拖动的百分比
        // mTopWhenCollapsed就是能拖动的总距离
        float fraction = 1 - mBackground.getTop() / (float) mTopWhenCollapsed;//from 0 to 1
        // 在这里根据拖动的百分比设置动画进度
        setProgress(fraction);
    &#125;

    @Override
    public void onViewReleased(@NonNull View releasedChild, float xvel, float yvel) &#123;
        // 当手指松开取消拖动时
        super.onViewReleased(releasedChild, xvel, yvel);
        // 根据Background view的速度、位置分别处理打开还是关闭Player
        if (yvel &gt; 0) &#123;
            collapsePlayer();
        &#125; else if (yvel &lt; 0) &#123;
            expandPlayer();
        &#125; else &#123;
            if (releasedChild.getTop() / (float) mTopWhenCollapsed &gt; .5f) &#123;
                collapsePlayer();
            &#125; else &#123;
                expandPlayer();
            &#125;
        &#125;
    &#125;

    @Override
    public int getViewVerticalDragRange(@NonNull View child) &#123;
        // 返回Background view所能垂直拖动的距离
        return mTopWhenCollapsed;
    &#125;

    @Override
    public int clampViewPositionVertical(@NonNull View child, int top, int dy) &#123;
        // 约束Background view在拖动中垂直方向上所允许Top范围
        // 返回值约束在0和mTopWhenCollapsed之间
        return Math.min(Math.max(0, top), mTopWhenCollapsed);
    &#125;

    @Override
    public int clampViewPositionHorizontal(@NonNull View child, int left, int dx) &#123;
        // 水平方向自适应
        return child.getLeft();
    &#125;
&#125;;
</code></pre>
<p>最后，是松手后实现自然折叠、展开的方法：</p>
<pre><code class="java">public void expandPlayer() &#123;
    if (mHelper.smoothSlideViewTo(mBackground, 0, 0)) &#123;
        ViewCompat.postInvalidateOnAnimation(this);
    &#125;
&#125;

public void collapsePlayer() &#123;
    if (mHelper.smoothSlideViewTo(mBackground, 0, mTopWhenCollapsed)) &#123;
        ViewCompat.postInvalidateOnAnimation(this);
    &#125;
&#125;

@Override
public void computeScroll() &#123;
    if (mHelper.continueSettling(true)) &#123;
        ViewCompat.postInvalidateOnAnimation(this);
    &#125;
&#125;
</code></pre>
<p>这样，就完成了最基本的框架就完成了，核心思想就是在<code>ViewDragHelper.Callback</code><strong>中监听滑动的比例，然后为<code>MotionLayout</code>设置动画的比例</strong>，当然还有很多小细节的处理。预览图那样的效果不过是在此基础上增加了更多的<code>view</code>和动画。</p>
<h2 id="其他冷知识"><a href="#其他冷知识" class="headerlink" title="其他冷知识"></a>其他冷知识</h2><h3 id="如何渐变圆角？"><a href="#如何渐变圆角？" class="headerlink" title="如何渐变圆角？"></a>如何渐变圆角？</h3><p>可以看到我们的预览图中，播放器折叠时左上角有圆角，但是随着滑动，圆角逐渐消失最终不见。这是如何实现的呢？</p>
<h4 id="MaterialShapeDrawable"><a href="#MaterialShapeDrawable" class="headerlink" title="MaterialShapeDrawable"></a>MaterialShapeDrawable</h4><p>使用前先导入google的design库：</p>
<pre><code class="groovy">implementation &#39;com.google.android.material:material:1.2.1&#39;
</code></pre>
<p>构造实例并使用：</p>
<pre><code class="java">// 构造左上角圆角的ShapeAppearanceModel
mDefShapeAppearance = ShapeAppearanceModel.builder().setTopLeftCorner(CornerFamily.ROUNDED, defCornerSize).build();
// 根据ShapeAppearanceModel初始化MaterialShapeDrawable
mBackgroundDrawable = new MaterialShapeDrawable(mDefShapeAppearance);
// 将此Drawable设为View的背景
view.setBackground(mBackgroundDrawable);
</code></pre>
<p>提供改变圆角的方法：</p>
<pre><code class="java">public void setTopLeftCornerSize(float cornerSize) &#123;
  mBackgroundDrawable.setShapeAppearanceModel(mDefShapeAppearance.toBuilder().setTopLeftCorner(CornerFamily.ROUNDED, cornerSize).build());
&#125;
</code></pre>
<h4 id="Custom-Attributes"><a href="#Custom-Attributes" class="headerlink" title="Custom Attributes"></a>Custom Attributes</h4><p>如果想要<code>MotionLayout</code>自动在动画过程中改变圆角，而不用手动设置，可以使用上面提及的<strong>自定义属性</strong>。新建一个自定义View继承自你想设置圆角的那个View的类，然后把上面设置圆角的方法内置到该类中。</p>
<p>在编辑器中选中该view，在其约束编辑窗口中找到此按钮<img src="/post/MotionLayout+ViewDragHelper/image-20210310151249634.png" alt="image-20210310151249634" style="zoom:67%;">然后会弹出此窗口：</p>
<img src="/post/MotionLayout+ViewDragHelper/image-20210310151412639.png" alt="image-20210310151412639" style="zoom:67%;">

<p>在“start”和“end”两个<code>ConstranitSet</code>中分别配置<code>Value</code>就行了。</p>
<h3 id="如何渐变状态栏颜色"><a href="#如何渐变状态栏颜色" class="headerlink" title="如何渐变状态栏颜色?"></a>如何渐变状态栏颜色?</h3><pre><code class="java">// 前提是windowTranslucentStatus = false且windowDrawsSystemBarBackgrounds = true
ObjectAnimator.ofArgb(activity.getWindow(), &quot;statusBarColor&quot;, customColor);
</code></pre>

        
                <blockquote style="margin: 2em 0 0;padding: 0.5em 1em;border-left: 3px solid #F44336;background-color: #F5F5F5;list-style: none;">
                    <p><strong>
                        
                            <a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a><br />本作品采用<a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。
                        </strong>
                        <br>
                        <strong>本文链接：</strong><a href="http://www.xjunz.top/post/MotionLayout+ViewDragHelper/">http://www.xjunz.top/post/MotionLayout+ViewDragHelper/</a>
                    </p>
                </blockquote>
        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
    <!-- 使用 DISQUS_CLICK -->
<div id="disqus-comment">
    <div id="disqus_thread"></div>

<!-- add animation -->
<style>
	.disqus_click_btn {
            line-height: 30px;
            margin: 0;
            min-width: 50px;
            padding: 0 14px;
            display: inline-block;
            font-family: "Roboto", "Helvetica", "Arial", sans-serif;
            font-size: 14px;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 0;
            overflow: hidden;
            will-change: box-shadow;
            transition: box-shadow .2s cubic-bezier(.4, 0, 1, 1), background-color .2s cubic-bezier(.4, 0, .2, 1), color .2s cubic-bezier(.4, 0, .2, 1);
            outline: 0;
            cursor: pointer;
            text-decoration: none;
            text-align: center;
            vertical-align: middle;
            border: 0;
            background: rgba(158, 158, 158, .2);
            box-shadow: 0 2px 2px 0 rgba(0, 0, 0, .14), 0 3px 1px -2px rgba(0, 0, 0, .2), 0 1px 5px 0 rgba(0, 0, 0, .12);
            color: #fff;
            background-color: #ff4e58;
            text-shadow: 0;
            display: none
        }
</style>
	
<div class="btn_click_load"> 
    <button class="disqus_click_btn">阅读评论（请确保 disqus 可以正常加载）</button>
</div>

<script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'http://www.xjunz.top/post/MotionLayout+ViewDragHelper/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'http://www.xjunz.top/post/MotionLayout+ViewDragHelper/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
</script>

<script type="text/ls-javascript" id="disqus-lazy-load-script">
    $.ajax({
        url: 'https://disqus.com/next/config.json',
        timeout: 4000,
        type: 'GET',
        success: (function() {
            var d = document;
            var s = d.createElement('script');
            s.src = '//www-xjunz-top.disqus.com/embed.js';
            s.setAttribute('data-timestamp', + new Date());
            (d.head || d.body).appendChild(s);
            $('.disqus_click_btn').css('display','none');
        })(),
        error: function() {
          $('.disqus_click_btn').css('display','block');
        }
    });
    $('.btn_click_load').click(function() {  //click to load comments
        (function() { // DON'T EDIT BELOW THIS LINE
            var d = document;
            var s = d.createElement('script');
            s.src = '//www-xjunz-top.disqus.com/embed.js';
            s.setAttribute('data-timestamp', + new Date());
            (d.head || d.body).appendChild(s);
        })();
        $('.disqus_click_btn').css('display','none');
    });
</script>
  	

</div>
<style>
    #disqus-comment{
        background-color: #eee;
        padding: 2pc;
    }
</style>

                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/post/Android-Return-Transition-Patcher/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/post/DatabindingNotes/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="xjunz's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        1409122313@qq.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="mailto:1409122313@qq.com" target="_blank" title="Mailto">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Mailto
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2022/07/">七月 2022<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2022/03/">三月 2022<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2021/03/">三月 2021<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/04/">四月 2019<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                分类
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/Android-Dev/">Android Dev<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/Android-UI-UX/">Android UI/UX<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/%E6%9D%82%E8%B0%88/">杂谈<span class="sidebar_archives-count">2</span></a>
            </ul>
        </li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="/timeline" title="时•光">
                
                    <i class="material-icons sidebar-material-icons">history</i>
                
                时•光
            </a>
        </li>
        
    
        <li>
            <a href="/tags/trite" title="牙慧">
                
                    <i class="material-icons sidebar-material-icons">book</i>
                
                牙慧
            </a>
        </li>
        
    
        <li>
            <a href="/gallery" title="画廊">
                
                    <i class="material-icons sidebar-material-icons">local_florist</i>
                
                画廊
            </a>
        </li>
        
    
        <li>
            <a href="/about" title="关于">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                关于
            </a>
        </li>
        
            <li class="divider"></li>
        
    

    <!-- Article Number  -->
    
        <li>
            <a href="/archives">
                文章总数
                <span class="sidebar-badge">6</span>
            </a>
        </li>
        
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->


<!-- Help & Support -->
<!--

    <a href="mailto:ibh@live.com" class="sidebar-footer-text-a">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
        sidebar.help
        <span class="mdl-button__ripple-container">
          <span class="mdl-ripple"></span>
        </span>
      </div>
    </a>

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    

    <!-- Facebook -->
    

    <!-- Google + -->
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://github.com/xjunz" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-github">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    
        <a href="https://space.bilibili.com/124677178" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-bilibili">
                <span class="visuallyhidden">Bilibili</span>
            </button><!--
     --></a>
    

    <!-- Telegram -->
    
        <a href="https://t.me/xjunz" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-telegram">
                <span class="visuallyhidden">Telegram</span>
            </button><!--
     --></a>
    

    <!-- V2EX -->
    

    <!-- Segmentfault -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;<span year></span>&nbsp;Me, xjunz's blog
            
                <br>
                
                    <b>The confession of an average man</b>
                
            
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/bollnh/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","/js/lazyload.min.js?wgjW/HuQG9JDgvPDPoRAng==", true)</script>



    <script>lsloader.load("js_js","/js/js.min.js?LT4t6iE6m8TO1BLGGiNJqA==", true)</script>



    <script>lsloader.load("np_js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#ff4e58'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #ff4e58, 0 0 15px #ff4e58'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#ff4e58',
        'border-left-color': '#ff4e58'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>



    
        <script>lsloader.load("sm_js","/js/smoothscroll.js?tNQK2Tw2SUL8a1Scn/Mgew==", true)</script>
    





    <!-- Busuanzi -->
    <script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



   <!-- 使用 DISQUS js 代码 -->






<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('
<link rel="stylesheet" href="/css/uc.css">
');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Import prettify js  -->

    
        
            <script>lsloader.load("prettify_js","/js/prettify.min.js?WN07fivHQSMKWy7BmHBB6w==", true)</script>
        
    



<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
        
            $(function() {
                $('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto;');
                prettyPrint();
                })
        
    
    
</script>

<!-- MathJax Load-->


<!-- Bing Background -->

<script type="text/ls-javascript" id="Bing-Background-script">
    queue.offer(function(){
        $('body').attr('data-original', 'https://api.i-meto.com/bing?S');
    });
</script>


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->


    
        
    


<script>
    var copyrightNow = new Date().getFullYear();
    var textContent = document.querySelector('span[year]')

    copyrightSince = 2019;
    if (copyrightSince === copyrightNow||copyrightSince === 0000) {
        textContent.textContent = copyrightNow
    } else {
        textContent.textContent = copyrightSince + ' - ' + copyrightNow
    }

    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.5.6 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        </body>
    
</html>

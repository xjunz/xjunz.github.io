<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head>
    <meta charset="utf-8">
    <meta name="google-site-verification" content="Is5NCRh3gMI3ic8PKbNsXzLtoQu1b2ywfIoPhkv3JYA" />
    <!--
        © Material Theme
        https://github.com/bollnh/hexo-theme-material
        Version: 1.5.6 -->
    <script>
        window.materialVersion = "1.5.6"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1',
            '1.5.0',
            '1.5.2',
            '1.5.5'
        ]
    </script>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">



    <link rel="dns-prefetch" href="https://busuanzi.ibruce.info"/>



    <link rel="dns-prefetch" href="https://www-xjunz-top.disqus.com"/>





    <link rel="dns-prefetch" href="https://fonts.googleapis.com"/>





    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="renderer" content="webkit">
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"> -->

    <!-- Title -->
    
    <title>
        
            Android 10 及以上，(Shared Element) Return Transition在特定情况下失效的问题探究 | 
        
        Me, xjunz&#39;s blog
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.svg">
    <link rel="icon" href="/img/favicon.svg">

    <meta name="format-detection" content="telephone=no"/>
    <meta name="description" itemprop="description" content="xjunz&#39;s blog">
    <meta name="keywords" content="">
    <meta name="theme-color" content="#ffc3ac">

    <!-- Disable Fucking Bloody Baidu Tranformation -->
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(a){try{localStorage.removeItem(a)}catch(b){}};lsloader.setLS=function(a,c){try{localStorage.setItem(a,c)}catch(b){}};lsloader.getLS=function(a){var c="";try{c=localStorage.getItem(a)}catch(b){c=""}return c};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var b=[];for(var a=0;a<localStorage.length;a++){b.push(localStorage.key(a))}b.forEach(function(e){var f=lsloader.getLS(e);if(window.oldVersion){var d=window.oldVersion.reduce(function(g,h){return g||f.indexOf("/*"+h+"*/")!==-1},false);if(d){lsloader.removeLS(e)}}})}catch(c){}};lsloader.clean();lsloader.load=function(f,a,b,d){if(typeof b==="boolean"){d=b;b=undefined}d=d||false;b=b||function(){};var e;e=this.getLS(f);if(e&&e.indexOf(versionString)===-1){this.removeLS(f);this.requestResource(f,a,b,d);return}if(e){var c=e.split(versionString)[0];if(c!=a){console.log("reload:"+a);this.removeLS(f);this.requestResource(f,a,b,d);return}e=e.split(versionString)[1];if(d){this.jsRunSequence.push({name:f,code:e});this.runjs(a,f,e)}else{document.getElementById(f).appendChild(document.createTextNode(e));b()}}else{this.requestResource(f,a,b,d)}};lsloader.requestResource=function(b,e,a,c){var d=this;if(c){this.iojs(e,b,function(h,f,g){d.setLS(f,h+versionString+g);d.runjs(h,f,g)})}else{this.iocss(e,b,function(f){document.getElementById(b).appendChild(document.createTextNode(f));d.setLS(b,e+versionString+f)},a)}};lsloader.iojs=function(d,b,g){var a=this;a.jsRunSequence.push({name:b,code:""});try{var f=new XMLHttpRequest();f.open("get",d,true);f.onreadystatechange=function(){if(f.readyState==4){if((f.status>=200&&f.status<300)||f.status==304){if(f.response!=""){g(d,b,f.response);return}}a.jsfallback(d,b)}};f.send(null)}catch(c){a.jsfallback(d,b)}};lsloader.iocss=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.iofonts=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.runjs=function(f,c,e){if(!!c&&!!e){for(var b in this.jsRunSequence){if(this.jsRunSequence[b].name==c){this.jsRunSequence[b].code=e}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var a=document.createElement("script");a.appendChild(document.createTextNode(this.jsRunSequence[0].code));a.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(a);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else{if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var d=this;var a=document.createElement("script");a.src=this.jsRunSequence[0].path;a.type="text/javascript";this.jsRunSequence[0].status="loading";a.onload=function(){d.jsRunSequence.shift();if(d.jsRunSequence.length>0){d.runjs()}};document.body.appendChild(a)}}};lsloader.tagLoad=function(b,a){this.jsRunSequence.push({name:a,code:"",path:b,status:"failed"});this.runjs()};lsloader.jsfallback=function(c,b){if(!!this.jsnamemap[b]){return}else{this.jsnamemap[b]=b}for(var a in this.jsRunSequence){if(this.jsRunSequence[a].name==b){this.jsRunSequence[a].code="";this.jsRunSequence[a].status="failed";this.jsRunSequence[a].path=c}}this.runjs()};lsloader.cssfallback=function(e,c,b){if(!!this.cssnamemap[c]){return}else{this.cssnamemap[c]=1}var d=document.createElement("link");d.type="text/css";d.href=e;d.rel="stylesheet";d.onload=d.onerror=b;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(d,a)};lsloader.runInlineScript=function(c,b){var a=document.getElementById(b).innerText;this.jsRunSequence.push({name:c,code:a});this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Import CSS -->
    <style id="xjunz-mod_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("xjunz-mod_css","/css/xjunz-mod.css?d684e0/w9qXktWXInVp03g==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","/css/material.min.css?Z7a72R1E4SxzBKR/WGctOA==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","/css/style.min.css?uVzgA6RLrOm13Ukw8Qgy+A==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        
            
                <style id="prettify_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_css","/css/prettify.min.css?zp8STOU9v89XWFEnN+6YmQ==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
                <style id="prettify_theme"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_theme","/css/prettify/github-v2.min.css?AfzKxt++K+/lhZBlSjnxwg==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
            
        

    

    

    <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Noto Serif SC, Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "微软雅黑", "Microsoft YaHei", Arial, sans-serif;
    overflow-x: hidden !important;
  }
  
  code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    letter-spacing: .0em !important;
  }

  a {
    color: #ff4e58;
    letter-spacing: .1em;
  }

  p.article-headline-p{
   font-family: Roboto !important;
  }

  p {
    letter-spacing: .15em;
    font-family: Noto Serif SC !important;
  }

  div {
    letter-spacing: .15em;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #ff4e58 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #ff4e58 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #ff4e58 !important;
  }

  .toTop {
    background: #ff4e58 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #ff4e58;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #ff4e58;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #ff4e58;
  }

  .post-toc a:hover {
    color: #ff4e58;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body {
        background-color: #faf2f1;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text {
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->
<!-- Import Roboto -->

    <!-- "https://fonts.googleapis.com/css?family=Roboto:300,400,500" -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC&display=swap" rel="stylesheet">




<!-- Import Material Icons -->


    <style id="material_icons"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_icons","/css/material-icons.css?pqhB/Rd/ab0H2+kZp0RDmw==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>




    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","/js/jquery.min.js?ezyEvm8ST5CGfpA+kFFi1g==", true)</script>
    

    <!-- WebAPP Icons -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Me, xjunz&#39;s blog">
    <meta name="msapplication-starturl" content="http://www.xjunz.top/post/Android-Return-Transition-Patcher/">
    <meta name="msapplication-navbutton-color" content="#ffc3ac">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Me, xjunz&#39;s blog">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="/img/favicon.svg">

    <!-- Site Verification -->
    
    

    <!-- RSS -->
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://www.xjunz.top/post/Android-Return-Transition-Patcher/">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Android 10 及以上，(Shared Element) Return Transition在特定情况下失效的问题探究 | Me, xjunz&#39;s blog">
    <meta property="og:image" content="/img/favicon.svg">
    <meta property="og:description" content="xjunz&#39;s blog">
    

    
        <meta property="article:published_time" content="Mon Mar 28 2022 01:50:00 GMT+0800">
        <meta property="article:modified_time" content="Wed Apr 06 2022 22:49:56 GMT+0800">
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:card" content="summary_large_image">

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="http://www.xjunz.top/post/Android-Return-Transition-Patcher/index.html" />
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "http://www.xjunz.top/post/Android-Return-Transition-Patcher/index.html",
    "headline": "Android 10 及以上，(Shared Element) Return Transition在特定情况下失效的问题探究",
    "datePublished": "Mon Mar 28 2022 01:50:00 GMT+0800",
    "dateModified": "Wed Apr 06 2022 22:49:56 GMT+0800",
    "author": {
        "@type": "Person",
        "name": "xjunz",
        "image": {
            "@type": "ImageObject",
            "url": "/img/avatar.png"
        },
        "description": ""
    },
    "publisher": {
        "@type": "Organization",
        "name": "Me, xjunz&#39;s blog",
        "logo": {
            "@type":"ImageObject",
            "url": "/img/favicon.svg"
        }
    },
    "keywords": "",
    "description": "xjunz&#39;s blog",
}
</script>


    

    <!-- Analytics -->
    
    
    

    <!-- Custom Head -->
    
        
            
        
    
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="/custom_css_source.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.1.0"></head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span id="MD-burger-id" class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Android-10-%E5%8F%8A%E4%BB%A5%E4%B8%8A%EF%BC%8C-Shared-Element-Return-Transition%E5%9C%A8%E7%89%B9%E5%AE%9A%E6%83%85%E5%86%B5%E4%B8%8B%E5%A4%B1%E6%95%88%E7%9A%84%E9%97%AE%E9%A2%98%E6%8E%A2%E7%A9%B6"><span class="post-toc-text">Android 10 及以上，(Shared Element) Return Transition在特定情况下失效的问题探究</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%A4%8D%E7%8E%B0"><span class="post-toc-text">复现</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%88%87%E5%85%A5"><span class="post-toc-text">切入</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%AE%89%E5%8D%9310%E4%B9%8B%E5%89%8D%EF%BC%9F"><span class="post-toc-text">安卓10之前？</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E8%A1%A5%E4%B8%81%E4%BB%A3%E7%A0%81"><span class="post-toc-text">补丁代码</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%8F%8D%E5%B0%84%E5%BC%8F"><span class="post-toc-text">反射式</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E9%9D%9E%E5%8F%8D%E5%B0%84%E5%BC%8F"><span class="post-toc-text">非反射式</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Android-12-PE%E4%B8%8A%E5%A5%87%E6%80%AA%E7%9A%84%E7%8E%B0%E8%B1%A1"><span class="post-toc-text">Android 12 PE上奇怪的现象</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%BD%BF%E7%94%A8ReturnTransitionPatcher"><span class="post-toc-text">使用ReturnTransitionPatcher</span></a></li></ol></li></ol>
    </ul>
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        <!-- Custom Thumbnail -->
        <div class="post_thumbnail-custom mdl-card__media mdl-color-text--grey-50" style="background-image:url(/post/Android-Return-Transition-Patcher/thumbnail.webp)">
    
            <p class="article-headline-p">
                Android 10 及以上，(Shared Element) Return Transition在特定情况下失效的问题探究
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>xjunz</strong>
        <span>3月 28, 2022</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    
        <button id="article-functions-qrcode-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">devices other</i>
    <span class="visuallyhidden">devices other</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-qrcode-button">
    <li class="mdl-menu__item">在其它设备中阅读本文章</li>
    
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPYAAAD2CAAAAADAeSUUAAAC1UlEQVR42u3aQW4jMQwEwPz/09nrXsbpppRgIJVORjDWqOgDQ1Jf31euL2xsbGxsbGxsbOxXsr/iFW3935PJDk/PPP1l5czY2NjYZ7NzzNOhE8wK+CkE+ZmxsbGxb2B/Pkr+uSgPHkL2ObjtmbGxsbGx8wJjVsAkAcXGxsbG/g12ss+uFIiNjY2NvauptFIqtG2pvFz59V4aNjY29uvZ+dD0PZ//dL6NjY2N/WL2rKHfXuKZDXTbpPXDSbCxsbEPZeeJIQlBzsgbUkkoo29hY2NjX8POU1detLStopVG0uOPhI2NjX00e5YwfmjH5+2eMpSzpIuNjY19Krsel8appQ1Ess9KEwobGxv7VHZeQqyvJF19JuXpDRsbG/tO9krBsOFY5Ri4Hf1iY2Njn81uh69t2ssDl/8YdfLDxsbGPpTd/qM/KwzyN+5qQmFjY2PfzG4Pt45sG1Kfk2I9FcHGxsY+iB2lgYUioS14Zsn1cQdsbGzsC9izhn7bpk/C2g6Y60EvNjY29kHsWeJpy4w20LsSHjY2NvYN7BkpKVGSdtWuRBWVPdjY2NhHs6MrL+WlnJX987cnYcXGxsa+h92mpbwIyXduw51fFcLGxsa+h73rak5eZrRpqS1CsLGxse9hz5rys9SVw/Lip758iY2NjX0Ee1Z+tM2m9XDkl3uiBIaNjY19KLu9dpkPa3PASqOqaCphY2NjH8ouhqZx63+lGZQ3ub6DhY2NjX0Du23H5wfaNcptL2ViY2Nj38BuVzLE3dVyml0YenwSGxsb+1B2myTyI+ZFzvpAN3o7NjY29tHslRbSym75d2eXe7CxsbFvY6+PV9eLjb0LGxsbGzshtallNpyYvR0bGxsbO39xfhEnf9fs4s6fJjBsbGzsl7Hzhs76SCB/e/7z/GIvDRsbG/v17NkFx6T8yBtM7f4bmkrY2NjYR7DvWdjY2NjY2NjY2NivWf8ALztTJUD6mBsAAAAASUVORK5CYII=">
    
</ul>

    

    <!-- Tags (bookmark) -->
    

    <!-- Share -->
    
        <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    
        
            <!-- Busuanzi Views -->
            <a class="post_share-link" href="#">
                <li class="mdl-menu__item">
                    <span id="busuanzi_container_page_pv">
                        <span id="busuanzi_value_page_pv"></span>&nbsp;浏览量
                    </span>
                </li>
            </a>
        
    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=Android 10 及以上，(Shared Element) Return Transition在特定情况下失效的问题探究&url=http://www.xjunz.top/post/Android-Return-Transition-Patcher/index.html&pic=http://www.xjunz.top/img/favicon.svg&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=Android 10 及以上，(Shared Element) Return Transition在特定情况下失效的问题探究&url=http://www.xjunz.top/post/Android-Return-Transition-Patcher/index.html&via=xjunz" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://www.xjunz.top/post/Android-Return-Transition-Patcher/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    
        <a class="post_share-link" href="http://connect.qq.com/widget/shareqq/index.html?site=Me, xjunz&#39;s blog&title=Android 10 及以上，(Shared Element) Return Transition在特定情况下失效的问题探究&summary=xjunz&#39;s blog&pics=http://www.xjunz.top/img/favicon.svg&url=http://www.xjunz.top/post/Android-Return-Transition-Patcher/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 QQ
            </li>
        </a>
    

    <!-- Share Telegram -->
    
        <a class="post_share-link" href="https://telegram.me/share/url?url=http://www.xjunz.top/post/Android-Return-Transition-Patcher/index.html&text=Android 10 及以上，(Shared Element) Return Transition在特定情况下失效的问题探究" target="_blank">
            <li class="mdl-menu__item">
                分享到 Telegram
            </li>
        </a>
    
</ul>

    
</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
            
         <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="Android-10-及以上，-Shared-Element-Return-Transition在特定情况下失效的问题探究"><a href="#Android-10-及以上，-Shared-Element-Return-Transition在特定情况下失效的问题探究" class="headerlink" title="Android 10 及以上，(Shared Element) Return Transition在特定情况下失效的问题探究"></a>Android 10 及以上，(Shared Element) Return Transition在特定情况下失效的问题探究</h1><blockquote>
<p>文章可能存在错误或疏漏，欢迎批评斧正…</p>
</blockquote>
<h2 id="复现"><a href="#复现" class="headerlink" title="复现"></a>复现</h2><p><strong>复现方式</strong>：<strong>Activity A</strong>通过<code>(Shared Element) Enter Transition</code> 进入<strong>Activity B</strong>, 在<strong>Actitivty B</strong> 内进入另一个<strong>Activity</strong>（APP内或其他APP都行），然后回到<strong>Activity B</strong>，点击返回键</p>
<p><strong>预期结果</strong>：<strong>Activity B</strong> 会通过<code>(Shared Element) Return Trasition</code> 回到<strong>Activity A</strong></p>
<p><strong>实际结果</strong>：完全没有执行任何<code>Transition</code>动画，直接回到了<strong>Activity A</strong></p>
<p><strong>影响范围</strong>：<strong>Android 10</strong>及以上版本，并且到目前（<em>2022-3-26</em>）都没有修复</p>
<h2 id="切入"><a href="#切入" class="headerlink" title="切入"></a>切入</h2><p>其实很久以前就发现了这个问题，但是一直没有实际去解决，因为这个BUG的影响并不是很大。在搜索引擎上，国内外许多人也遇到了相同的问题，可是看起来大家都很忙，并没有人提供一个特别好的解决方案。不巧我今天正好又遇到了，而且有点闲暇时间，便决定去一探究竟。</p>
<p>切入点很好找，当我们点击返回键时，就会走<code>finishAfterTransition</code>以执行<code>Transition</code>动画，那么就从这里入手：</p>
<p><img src="/post/Android-Return-Transition-Patcher/image-20220327022215849.png" alt="image-20220327022215849"></p>
<p>很明显在异常情况下<code>startExitBackTransition()</code>返回了<code>false</code>。点这个方法，进入到<code>android.app.ActivityTransitionState</code>类中（<strong>注</strong>：以下所有图片中的代码若未说明都来自这个类）：</p>
<p><img src="/post/Android-Return-Transition-Patcher/image-20220327022518986.png" alt="image-20220327022518986">通过断点调试发现正常情况和异常情况的区别在于<code>getPendingExitNames()</code>是否为<code>null</code>：如果它为<code>null</code>，该方法就会返回<code>false</code>，那么<code>Transition</code>就不会执行。这个方法里的逻辑很简单，就是懒加载并返回了<code>mPendingExitNames</code>这个成员变量：</p>
<p><img src="/post/Android-Return-Transition-Patcher/image-20220327022714802.png" alt="image-20220327022714802"></p>
<p>还是通过断点发现，正常和异常情况的区别在于<code>mEnterTransitionCoordinator</code>是否为<code>null</code>，异常情况下这个变量为<code>null</code>，导致<code>mPendingExitNames</code>无法初始化，从而返回<code>null</code>。那么我们的思路就是找到何时<code>mEnterTransitionCoordinator</code>被置空。代码里有多处置空的地方，但是鉴于异常情况只有在<code>Activity</code>切换出去以后才会发生。那么，最可疑的地方莫过于<code>onStop</code>方法里面的置空处理：</p>
<p><img src="/post/Android-Return-Transition-Patcher/image-20220327022929123.png" alt="image-20220327022929123">验证之后，问题就明了了：正常情况下，<code>getPendingExitNames</code>会初始化<code>mPendingExitNames</code>。但是异常情况下，由于走了<code>onStop</code>，<code>mEnterTransitionCoordinator</code>被置空，导致<code>mPendingExitNames</code>始终无法初始化最终导致了这个BUG。</p>
<h2 id="安卓10之前？"><a href="#安卓10之前？" class="headerlink" title="安卓10之前？"></a>安卓10之前？</h2><p>但是为什么在安卓10之前没有这个问题呢？翻阅源码的修改记录，我发现了一条可疑的commit: <a target="_blank" rel="noopener" href="https://cs.android.com/android/_/android/platform/frameworks/base/+/d85bed510fd1aad7f5d764b9fb6ddfea3e5bb56e">d85bed5</a> 。我们看一下此commit对<a target="_blank" rel="noopener" href="https://cs.android.com/android/_/android/platform/frameworks/base/+/d85bed510fd1aad7f5d764b9fb6ddfea3e5bb56e:core/java/android/app/ActivityTransitionState.java;dlc=67f94b40024e07e64fd2875b7382b762805bebae"><code>android.app.ActivityTransitionState</code></a>这个类的修改：</p>
<p><img src="/post/Android-Return-Transition-Patcher/image-20220327024045779.png" alt="image-20220327024045779"></p>
<p>这个提交对这个类的修改在逻辑上的改动不大，主要修改就是成员<code>mEnteringNames</code>在语义上改为<code>mPendingExitNames</code>，本质上还是储存进入退出的共享元素的<code>Transition Names</code>的列表。关键在于，他将<code>mPendingExitNames</code>的获取方式变成了<code>getPendingExitNames()</code>方法来懒加载。而在安卓9的源码中，<code>mEnteringNames</code>会在<code>startEnter</code>方法中就被初始化，并且只会在<code>clear</code>方法中清空，那么此变量在整个<code>Acitivity Transition</code>的生命周期中始终是可用的，所以安卓10以前没有这个问题。</p>
<p>但是我们不禁疑问，谷歌程序员真的会犯这样的错误吗？继续看上面代码的第<strong>154</strong>行的<code>saveState</code>方法，这个方法会在<code>Acitivty.onSaveInstance()</code>中调用。因为<code>onSaveInstance</code>会在<code>onStop</code>之前调用，那么实际上<code>onStop</code>之前<code>mPendingExitNames</code>就会被初始化，所以…理论上…Android 10上的代码也是没有问题的，🤔怎么会是呢？</p>
<p>通过断点发现，实际上<code>onSaveInstance</code>在<code>onStop</code>之后调用了，所以<code>mPendingExitNames</code>保存了个寂寞。查阅文档才知道，原来<code>onSaveInstance</code>在安卓9有行为变更：</p>
<p><img src="/post/Android-Return-Transition-Patcher/image-20220327160844844.png" alt="image-20220327160844844"></p>
<p>显然，那位代码贡献者并没有考虑到这一变更，所以这才是罪魁祸首~</p>
<h2 id="补丁代码"><a href="#补丁代码" class="headerlink" title="补丁代码"></a>补丁代码</h2><h3 id="反射式"><a href="#反射式" class="headerlink" title="反射式"></a>反射式</h3><p>既然已经知道了问题所在，那么解决方法便呼之欲出了。解决方法很简单，在<code>onStop</code>前，我们调用至少一次<code>saveState</code>对<code>mPendingExitNames</code>进行初始化，这个方法是无副作用的，我们可以放心调用。但是<code>onStop</code>之前有很多时机，我们要确保<code>mEnterTransitionCoordinator</code>已经初始化。搜索发现，<code>mEnterTransitionCoordinator</code>初始化的地方在<code>enterReady(Activity)</code>中，而这个方法在<code>Activity.onStart()</code>中调用的，那么我们在<code>Activity</code>的<code>onStart</code>和<code>onStop</code>之间打补丁就行了：</p>
<ul>
<li><strong>注</strong>：这个<code>Acitivty</code>指的是复现方式中的<strong>Acitivty B</strong>；<code>saveState</code>不在反射黑名单，我们可以反射调用。</li>
</ul>
<pre><code class="kotlin">@SuppressLint(&quot;DiscouragedPrivateApi&quot;)
fun patchActivity(activity: Activity) &#123;
    if (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.Q) return
    try &#123;
        val field = Activity::class.java.getDeclaredField(&quot;mActivityTransitionState&quot;).run &#123;
            isAccessible = true
            get(activity)
        &#125;
        field.javaClass.getDeclaredMethod(&quot;saveState&quot;, Bundle::class.java).run &#123;
            invoke(field, Bundle())
        &#125;
    &#125; catch (t: Throwable) &#123;
        Log.e(&quot;ReturnTransitionPatcher&quot;, &quot;Patch failed for [$&#123;activity.javaClass.simpleName&#125;]&quot;)
        t.printStackTrace()
    &#125;
&#125;
</code></pre>
<h3 id="非反射式"><a href="#非反射式" class="headerlink" title="非反射式"></a>非反射式</h3><p>反射的代码总让人感觉嘎吱作响，需要很小心地维护，那么我们能否找到不需要反射的解决方法呢？我们之前分析过了，<code>saveState</code>在<code>Activity.onSaveInstance</code>中调用，那么我们手动在<code>onStop</code>之前<code>onStart</code>之后手动调用<code>onSaveInstance</code>也能修复这个问题，这个方法不用反射调用，稳健性较好：</p>
<pre><code class="kotlin">fun patchActivity(activity: Activity) &#123;
    if (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.Q) return
    Instrumentation().callActivityOnSaveInstanceState(activity, Bundle())
&#125;
</code></pre>
<h2 id="Android-12-PE上奇怪的现象"><a href="#Android-12-PE上奇怪的现象" class="headerlink" title="Android 12 PE上奇怪的现象"></a>Android 12 PE上奇怪的现象</h2><p>在Android 11及以前，将APP退回出到最近任务，也会走<code>onStop</code>触发这个BUG。但是在我的Pixel 5的Android 12上，退出到最近任务，并不会触发这个BUG。调试发现，是因为没走<code>onStop</code>。原来PE 的Launcher对于刚刚退回到最近任务的APP，不再是显示其静态快照，而是将APP缩放，因此在最近任务页面仍然能看到该APP的UI更新。谷歌你做得好啊，做得好啊。</p>
<h2 id="使用ReturnTransitionPatcher"><a href="#使用ReturnTransitionPatcher" class="headerlink" title="使用ReturnTransitionPatcher"></a>使用<em>ReturnTransitionPatcher</em></h2><p>代码已经上传到<a target="_blank" rel="noopener" href="https://github.com/xjunz/ReturnTransitionPatcher">github</a>和Maven仓库，如果你想在项目中修复这个问题，可以在项目中引入，该库提供了完美的Patch时机和全局Patch功能:</p>
<pre><code class="groovy">implementation &#39;io.github.xjunz:return-transition-patcher:+&#39;
</code></pre>

        
                <blockquote style="margin: 2em 0 0;padding: 0.5em 1em;border-left: 3px solid #F44336;background-color: #F5F5F5;list-style: none;">
                    <p><strong>
                        
                            <a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a><br />本作品采用<a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。
                        </strong>
                        <br>
                        <strong>本文链接：</strong><a href="http://www.xjunz.top/post/Android-Return-Transition-Patcher/">http://www.xjunz.top/post/Android-Return-Transition-Patcher/</a>
                    </p>
                </blockquote>
        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
    <!-- 使用 DISQUS_CLICK -->
<div id="disqus-comment">
    <div id="disqus_thread"></div>

<!-- add animation -->
<style>
	.disqus_click_btn {
            line-height: 30px;
            margin: 0;
            min-width: 50px;
            padding: 0 14px;
            display: inline-block;
            font-family: "Roboto", "Helvetica", "Arial", sans-serif;
            font-size: 14px;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 0;
            overflow: hidden;
            will-change: box-shadow;
            transition: box-shadow .2s cubic-bezier(.4, 0, 1, 1), background-color .2s cubic-bezier(.4, 0, .2, 1), color .2s cubic-bezier(.4, 0, .2, 1);
            outline: 0;
            cursor: pointer;
            text-decoration: none;
            text-align: center;
            vertical-align: middle;
            border: 0;
            background: rgba(158, 158, 158, .2);
            box-shadow: 0 2px 2px 0 rgba(0, 0, 0, .14), 0 3px 1px -2px rgba(0, 0, 0, .2), 0 1px 5px 0 rgba(0, 0, 0, .12);
            color: #fff;
            background-color: #ff4e58;
            text-shadow: 0;
            display: none
        }
</style>
	
<div class="btn_click_load"> 
    <button class="disqus_click_btn">阅读评论（请确保 disqus 可以正常加载）</button>
</div>

<script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'http://www.xjunz.top/post/Android-Return-Transition-Patcher/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'http://www.xjunz.top/post/Android-Return-Transition-Patcher/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
</script>

<script type="text/ls-javascript" id="disqus-lazy-load-script">
    $.ajax({
        url: 'https://disqus.com/next/config.json',
        timeout: 4000,
        type: 'GET',
        success: (function() {
            var d = document;
            var s = d.createElement('script');
            s.src = '//www-xjunz-top.disqus.com/embed.js';
            s.setAttribute('data-timestamp', + new Date());
            (d.head || d.body).appendChild(s);
            $('.disqus_click_btn').css('display','none');
        })(),
        error: function() {
          $('.disqus_click_btn').css('display','block');
        }
    });
    $('.btn_click_load').click(function() {  //click to load comments
        (function() { // DON'T EDIT BELOW THIS LINE
            var d = document;
            var s = d.createElement('script');
            s.src = '//www-xjunz-top.disqus.com/embed.js';
            s.setAttribute('data-timestamp', + new Date());
            (d.head || d.body).appendChild(s);
        })();
        $('.disqus_click_btn').css('display','none');
    });
</script>
  	

</div>
<style>
    #disqus-comment{
        background-color: #eee;
        padding: 2pc;
    }
</style>

                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/post/RetroMaterialTheme/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/post/MotionLayout+ViewDragHelper/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="xjunz's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        1409122313@qq.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="mailto:1409122313@qq.com" target="_blank" title="Mailto">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Mailto
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2022/03/">三月 2022<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2021/03/">三月 2021<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/04/">四月 2019<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                分类
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/Android-Dev/">Android Dev<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/Android-UI-UX/">Android UI/UX<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/%E6%9D%82%E8%B0%88/">杂谈<span class="sidebar_archives-count">2</span></a>
            </ul>
        </li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="/timeline" title="时•光">
                
                    <i class="material-icons sidebar-material-icons">history</i>
                
                时•光
            </a>
        </li>
        
    
        <li>
            <a href="/tags/trite" title="牙慧">
                
                    <i class="material-icons sidebar-material-icons">book</i>
                
                牙慧
            </a>
        </li>
        
    
        <li>
            <a href="/gallery" title="画廊">
                
                    <i class="material-icons sidebar-material-icons">local_florist</i>
                
                画廊
            </a>
        </li>
        
    
        <li>
            <a href="/about" title="关于">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                关于
            </a>
        </li>
        
            <li class="divider"></li>
        
    

    <!-- Article Number  -->
    
        <li>
            <a href="/archives">
                文章总数
                <span class="sidebar-badge">5</span>
            </a>
        </li>
        
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->


<!-- Help & Support -->
<!--

    <a href="mailto:ibh@live.com" class="sidebar-footer-text-a">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
        sidebar.help
        <span class="mdl-button__ripple-container">
          <span class="mdl-ripple"></span>
        </span>
      </div>
    </a>

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    

    <!-- Facebook -->
    

    <!-- Google + -->
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://github.com/xjunz" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-github">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    
        <a href="https://space.bilibili.com/124677178" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-bilibili">
                <span class="visuallyhidden">Bilibili</span>
            </button><!--
     --></a>
    

    <!-- Telegram -->
    
        <a href="https://t.me/xjunz" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-telegram">
                <span class="visuallyhidden">Telegram</span>
            </button><!--
     --></a>
    

    <!-- V2EX -->
    

    <!-- Segmentfault -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;<span year></span>&nbsp;Me, xjunz's blog
            
                <br>
                
                    <b>The confession of an average man</b>
                
            
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/bollnh/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","/js/lazyload.min.js?wgjW/HuQG9JDgvPDPoRAng==", true)</script>



    <script>lsloader.load("js_js","/js/js.min.js?LT4t6iE6m8TO1BLGGiNJqA==", true)</script>



    <script>lsloader.load("np_js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#ff4e58'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #ff4e58, 0 0 15px #ff4e58'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#ff4e58',
        'border-left-color': '#ff4e58'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>



    
        <script>lsloader.load("sm_js","/js/smoothscroll.js?tNQK2Tw2SUL8a1Scn/Mgew==", true)</script>
    





    <!-- Busuanzi -->
    <script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



   <!-- 使用 DISQUS js 代码 -->






<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('
<link rel="stylesheet" href="/css/uc.css">
');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Import prettify js  -->

    
        
            <script>lsloader.load("prettify_js","/js/prettify.min.js?WN07fivHQSMKWy7BmHBB6w==", true)</script>
        
    



<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
        
            $(function() {
                $('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto;');
                prettyPrint();
                })
        
    
    
</script>

<!-- MathJax Load-->


<!-- Bing Background -->

<script type="text/ls-javascript" id="Bing-Background-script">
    queue.offer(function(){
        $('body').attr('data-original', 'https://api.i-meto.com/bing?S');
    });
</script>


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->


    
        
    


<script>
    var copyrightNow = new Date().getFullYear();
    var textContent = document.querySelector('span[year]')

    copyrightSince = 2019;
    if (copyrightSince === copyrightNow||copyrightSince === 0000) {
        textContent.textContent = copyrightNow
    } else {
        textContent.textContent = copyrightSince + ' - ' + copyrightNow
    }

    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.5.6 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        </body>
    
</html>
